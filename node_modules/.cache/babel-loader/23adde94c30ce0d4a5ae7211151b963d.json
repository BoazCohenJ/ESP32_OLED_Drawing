{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\wikx3\\\\Documents\\\\VS_code\\\\React\\\\AOD\\\\src\\\\components\\\\pixelGrid\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\nimport FreeformMode from './FreeFormMode';\nimport LineMode from './LineMode';\nimport ResetButton from './ResetButton';\nimport { getCoordinates } from './utils';\nimport CircleMode from './CircleMode';\nimport BucketFillMode from './BucketFillMode';\nimport { useUndoRedo } from './useUndoRedo';\nimport RectangleMode from './RectangleMode';\nimport ESP32Connection from '../ESP32Connection';\nimport BMPHandler from '../BMPHandler';\n\n// Performance optimization - use off-screen canvas for rendering\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useOffscreenCanvas = () => {\n  _s();\n  const canvasRef = useRef(null);\n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    canvas.width = 128;\n    canvas.height = 64;\n    canvasRef.current = canvas;\n  }, []);\n  return canvasRef;\n};\n\n// Pixel component is causing performance issues - remove and use direct canvas rendering instead\n_s(useOffscreenCanvas, \"UJgi7ynoup7eqypjnwyX/s32POg=\");\nconst PixelGrid = () => {\n  _s2();\n  const [pixels, setPixels] = useState(Array(8192).fill(false));\n  const [isLineModeActive, setIsLineModeActive] = useState(false);\n  const [isCircleModeActive, setIsCircleModeActive] = useState(false);\n  const [isBucketFillModeActive, setIsBucketFillModeActive] = useState(false);\n  const [isRectangleModeActive, setIsRectangleModeActive] = useState(false);\n  const [previewPixels, setPreviewPixels] = useState(Array(8192).fill(false));\n  const canvasRef = useRef(null);\n  const offscreenCanvasRef = useOffscreenCanvas();\n  const isDrawingRef = useRef(false);\n  const startPointRef = useRef(null);\n  const lastPointRef = useRef(null);\n  const [isSpacePressed, setIsSpacePressed] = useState(false);\n  const currentIndexRef = useRef(null);\n  const [brushSize, setBrushSize] = useState(1);\n  const [drawColor, setDrawColor] = useState(true); // true for white, false for black\n  const rafRef = useRef(null); // For requestAnimationFrame\n  const pendingUpdatesRef = useRef(null); // Store pending pixel updates\n  const outlineRef = useRef(null);\n  const {\n    addToHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo\n  } = useUndoRedo(Array(8192).fill(false));\n\n  // Function to render pixels to canvas - critical for performance\n  const renderCanvas = useCallback(() => {\n    if (!canvasRef.current || !offscreenCanvasRef.current) return;\n    const ctx = offscreenCanvasRef.current.getContext('2d', {\n      alpha: false\n    });\n    ctx.fillStyle = '#000000'; // Black background\n    ctx.fillRect(0, 0, 128, 64);\n\n    // Draw white pixels\n    ctx.fillStyle = '#FFFFFF';\n    for (let y = 0; y < 64; y++) {\n      for (let x = 0; x < 128; x++) {\n        const idx = y * 128 + x;\n        if (previewPixels[idx] === true || pixels[idx] === true && previewPixels[idx] !== 'black-preview') {\n          ctx.fillRect(x, y, 1, 1);\n        }\n      }\n    }\n\n    // Scale and draw to visible canvas\n    const visibleCtx = canvasRef.current.getContext('2d', {\n      alpha: false\n    });\n    visibleCtx.imageSmoothingEnabled = false;\n    visibleCtx.drawImage(offscreenCanvasRef.current, 0, 0, 128, 64, 0, 0, canvasRef.current.width, canvasRef.current.height);\n  }, [pixels, previewPixels]);\n\n  // Batch update pixels with requestAnimationFrame for better performance\n  const batchPixelUpdate = useCallback(updateFn => {\n    if (rafRef.current) return; // Already have a pending update\n\n    pendingUpdatesRef.current = updateFn;\n    rafRef.current = requestAnimationFrame(() => {\n      if (pendingUpdatesRef.current) {\n        setPixels(prevPixels => pendingUpdatesRef.current(prevPixels));\n        pendingUpdatesRef.current = null;\n      }\n      rafRef.current = null;\n    });\n  }, []);\n\n  // Fix: Define and use batchPreviewUpdate\n  const batchPreviewUpdate = useCallback(updateFn => {\n    if (!updateFn) return;\n    requestAnimationFrame(() => {\n      setPreviewPixels(updateFn);\n    });\n  }, []);\n\n  // Update canvas when pixels or preview changes\n  useEffect(() => {\n    if (canvasRef.current) {\n      renderCanvas();\n    }\n  }, [pixels, previewPixels, renderCanvas]);\n\n  // Initialize canvas size on mount\n  useEffect(() => {\n    if (canvasRef.current) {\n      const updateCanvasSize = () => {\n        canvasRef.current.width = 1024;\n        canvasRef.current.height = 512;\n        renderCanvas();\n      };\n      updateCanvasSize();\n      window.addEventListener('resize', updateCanvasSize);\n      return () => {\n        window.removeEventListener('resize', updateCanvasSize);\n      };\n    }\n  }, [renderCanvas]);\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if (e.code === 'Space' && !isSpacePressed && currentIndexRef.current !== null) {\n        e.preventDefault();\n        setIsSpacePressed(true);\n        handleMouseDown(currentIndexRef.current);\n      } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'z') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          // Handle Ctrl+Shift+Z (Windows) or Cmd+Shift+Z (Mac)\n          handleRedo();\n        } else {\n          // Handle Ctrl+Z (Windows) or Cmd+Z (Mac)\n          handleUndo();\n        }\n      } else if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n        // Add alternative redo shortcut (Ctrl+Y)\n        e.preventDefault();\n        handleRedo();\n      } else if (e.key === 'b') {\n        // Shortcut for brush (freeform)\n        e.preventDefault();\n        setIsLineModeActive(false);\n        setIsCircleModeActive(false);\n        setIsBucketFillModeActive(false);\n      }\n    };\n    const handleKeyUp = e => {\n      if (e.code === 'Space') {\n        e.preventDefault();\n        setIsSpacePressed(false);\n        // Add state to history when space drawing ends\n        if (isDrawingRef.current) {\n          addToHistory([...pixels]);\n        }\n        handleMouseUp();\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [isSpacePressed, pixels, addToHistory]); // Add dependencies\n\n  // Clean up RAF on unmount\n  useEffect(() => {\n    return () => {\n      if (rafRef.current) {\n        cancelAnimationFrame(rafRef.current);\n        rafRef.current = null;\n      }\n    };\n  }, []);\n  const handlePixelUpdate = useCallback(updateFn => {\n    batchPixelUpdate(updateFn);\n  }, [batchPixelUpdate]);\n  const handleUndo = () => {\n    const previousState = undo();\n    if (previousState) {\n      setPixels(previousState);\n    }\n  };\n  const handleRedo = () => {\n    const nextState = redo();\n    if (nextState) {\n      setPixels(nextState);\n    }\n  };\n\n  // Use useMemo to calculate active mode only when dependencies change\n  const isFreeformActive = useMemo(() => {\n    return !isLineModeActive && !isCircleModeActive && !isBucketFillModeActive && !isRectangleModeActive;\n  }, [isLineModeActive, isCircleModeActive, isBucketFillModeActive, isRectangleModeActive]);\n\n  // Use useMemo for these mode objects to avoid re-creating on every render\n  const freeformMode = useMemo(() => FreeformMode({\n    isActive: isFreeformActive,\n    onPixelUpdate: handlePixelUpdate,\n    brushSize,\n    drawColor\n  }), [isFreeformActive, handlePixelUpdate, brushSize, drawColor]);\n  const lineMode = useMemo(() => LineMode({\n    isActive: isLineModeActive,\n    onPixelUpdate: handlePixelUpdate,\n    onPreviewUpdate: batchPreviewUpdate,\n    // Properly pass batchPreviewUpdate\n    drawColor\n  }), [isLineModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\n  const circleMode = useMemo(() => CircleMode({\n    isActive: isCircleModeActive,\n    onPixelUpdate: handlePixelUpdate,\n    onPreviewUpdate: batchPreviewUpdate,\n    // Properly pass batchPreviewUpdate\n    drawColor\n  }), [isCircleModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\n  const bucketFillMode = useMemo(() => BucketFillMode({\n    isActive: isBucketFillModeActive,\n    onPixelUpdate: handlePixelUpdate,\n    drawColor\n  }), [isBucketFillModeActive, handlePixelUpdate, drawColor]);\n  const rectangleMode = useMemo(() => RectangleMode({\n    isActive: isRectangleModeActive,\n    onPixelUpdate: handlePixelUpdate,\n    onPreviewUpdate: batchPreviewUpdate,\n    // Properly pass batchPreviewUpdate\n    drawColor\n  }), [isRectangleModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\n  const handleMouseDown = useCallback(index => {\n    isDrawingRef.current = true;\n    if (isBucketFillModeActive) {\n      // For bucket fill, execute fill immediately\n      bucketFillMode.handleFill(index, pixels);\n      addToHistory([...pixels]);\n      isDrawingRef.current = false;\n      return;\n    }\n    if (isFreeformActive) {\n      // For freeform mode, draw immediately on click\n      const point = getCoordinates(index);\n      lastPointRef.current = point;\n      freeformMode.handleStart(index);\n    } else {\n      startPointRef.current = getCoordinates(index);\n      lastPointRef.current = getCoordinates(index);\n    }\n  }, [pixels, bucketFillMode, isBucketFillModeActive, isFreeformActive, freeformMode, addToHistory]);\n  const handleMouseEnter = useCallback(index => {\n    if (!isDrawingRef.current) return;\n    if (isFreeformActive) {\n      // For freeform mode\n      lastPointRef.current = freeformMode.handleDraw(lastPointRef.current, index);\n    } else if (isLineModeActive) {\n      // For line mode\n      lineMode.handlePreview(startPointRef.current, index);\n      lastPointRef.current = getCoordinates(index);\n    } else if (isCircleModeActive) {\n      // For circle mode\n      circleMode.handlePreview(startPointRef.current, index);\n      lastPointRef.current = getCoordinates(index);\n    } else if (isRectangleModeActive) {\n      // For rectangle mode\n      rectangleMode.handlePreview(startPointRef.current, index);\n      lastPointRef.current = getCoordinates(index);\n    }\n  }, [isFreeformActive, freeformMode, isLineModeActive, lineMode, isCircleModeActive, circleMode, isRectangleModeActive, rectangleMode]);\n  const handleMouseUp = useCallback(() => {\n    if (isDrawingRef.current) {\n      if ((isLineModeActive || isCircleModeActive || isRectangleModeActive) && startPointRef.current && lastPointRef.current) {\n        const endIndex = lastPointRef.current.y * 128 + lastPointRef.current.x;\n        let updatedPixels = [...pixels];\n        if (isLineModeActive && lineMode.handleCommit) {\n          const linePoints = lineMode.handleCommit(startPointRef.current, endIndex);\n          if (linePoints) {\n            linePoints.forEach(idx => {\n              updatedPixels[idx] = drawColor;\n            });\n          }\n        } else if (isCircleModeActive && circleMode.handleCommit) {\n          const circlePoints = circleMode.handleCommit(startPointRef.current, endIndex);\n          if (circlePoints) {\n            circlePoints.forEach(idx => {\n              updatedPixels[idx] = drawColor;\n            });\n          }\n        } else if (isRectangleModeActive && rectangleMode.handleCommit) {\n          const rectanglePoints = rectangleMode.handleCommit(startPointRef.current, endIndex);\n          if (rectanglePoints) {\n            rectanglePoints.forEach(idx => {\n              updatedPixels[idx] = drawColor;\n            });\n          }\n        }\n        setPixels(updatedPixels);\n        setPreviewPixels(Array(8192).fill(false));\n        addToHistory(updatedPixels);\n      } else if (!isBucketFillModeActive) {\n        // For freeform, only save on mouse up\n        addToHistory([...pixels]);\n      }\n    }\n    isDrawingRef.current = false;\n    startPointRef.current = null;\n    lastPointRef.current = null;\n  }, [pixels, isLineModeActive, isCircleModeActive, isRectangleModeActive, isBucketFillModeActive, lineMode, circleMode, rectangleMode, drawColor, addToHistory]);\n  const handleReset = useCallback(() => {\n    const newState = Array(8192).fill(false);\n    setPixels(newState);\n    setPreviewPixels(Array(8192).fill(false));\n    startPointRef.current = null;\n    lastPointRef.current = null;\n    isDrawingRef.current = false;\n    addToHistory(newState);\n  }, [addToHistory]);\n  const handlePixelHover = useCallback(index => {\n    currentIndexRef.current = index;\n    if (isDrawingRef.current || isSpacePressed) {\n      handleMouseEnter(index);\n    }\n  }, [isSpacePressed, handleMouseEnter]);\n\n  // Use this cursor style for better performance (avoid style recalculations)\n  const cursorStyle = useMemo(() => {\n    if (isFreeformActive) return 'none';\n    if (isBucketFillModeActive) return 'cell';\n    return 'crosshair';\n  }, [isFreeformActive, isBucketFillModeActive]);\n\n  // Add brush outline effect\n  useEffect(() => {\n    const handleMouseMove = e => {\n      if (!outlineRef.current) return;\n\n      // Only show outline for freeform mode\n      if (isFreeformActive) {\n        const rect = document.querySelector('.pixel-grid').getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n\n        // Calculate which pixel we're hovering over\n        const pixelX = Math.floor(mouseX / 8);\n        const pixelY = Math.floor(mouseY / 8);\n\n        // Store the current pixel index for consistent drawing\n        const currentIndex = pixelY * 128 + pixelX;\n        currentIndexRef.current = currentIndex;\n        if (brushSize === 1) {\n          // For brush size 1, just show a simple pixel outline\n          if (pixelX >= 0 && pixelX < 128 && pixelY >= 0 && pixelY < 64) {\n            outlineRef.current.innerHTML = '';\n            outlineRef.current.style.left = `${pixelX * 8}px`;\n            outlineRef.current.style.top = `${pixelY * 8}px`;\n            outlineRef.current.style.width = `8px`;\n            outlineRef.current.style.height = `8px`;\n            outlineRef.current.style.display = 'block';\n            outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\n            outlineRef.current.style.borderRadius = '0'; // Ensure square shape\n          }\n        } else {\n          // Instead of creating a canvas each time, use pre-calculated DOM elements\n          // This is much more efficient\n          outlineRef.current.style.display = 'block';\n          outlineRef.current.innerHTML = '';\n          const minX = Math.max(0, pixelX - brushSize + 1);\n          const minY = Math.max(0, pixelY - brushSize + 1);\n          const maxX = Math.min(127, pixelX + brushSize - 1);\n          const maxY = Math.min(63, pixelY + brushSize - 1);\n          outlineRef.current.style.left = `${minX * 8}px`;\n          outlineRef.current.style.top = `${minY * 8}px`;\n          outlineRef.current.style.width = `${(maxX - minX + 1) * 8}px`;\n          outlineRef.current.style.height = `${(maxY - minY + 1) * 8}px`;\n          outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\n        }\n      } else {\n        outlineRef.current.style.display = 'none';\n      }\n    };\n    const grid = document.querySelector('.pixel-grid');\n    if (grid) {\n      grid.addEventListener('mousemove', handleMouseMove, {\n        passive: true\n      });\n    }\n    return () => {\n      if (grid) {\n        grid.removeEventListener('mousemove', handleMouseMove);\n      }\n    };\n  }, [brushSize, isFreeformActive, drawColor]);\n\n  // Use a more efficient approach to render pixels\n  // Create chunks of pixels to reduce the number of individual components\n  const pixelChunks = useMemo(() => {\n    const chunks = [];\n    // Generate chunks - each chunk contains 100 pixels\n    const chunkSize = 800;\n    for (let i = 0; i < pixels.length; i += chunkSize) {\n      chunks.push(pixels.slice(i, i + chunkSize));\n    }\n    return chunks;\n  }, [pixels]);\n\n  // Centralize the click handler to avoid recreating it for every pixel\n  const handlePixelClick = useCallback(event => {\n    event.preventDefault();\n    if (!currentIndexRef.current && currentIndexRef.current !== 0) return;\n    handleMouseDown(currentIndexRef.current);\n  }, [handleMouseDown]);\n\n  // Fix - Check if the grid is rendered\n  useEffect(() => {\n    console.log(\"Grid should contain:\", pixels.length, \"pixels\");\n    const grid = document.querySelector('.pixel-grid');\n    console.log(\"Grid element exists:\", !!grid);\n  }, []);\n\n  // Handle mouse events on canvas instead of individual divs\n  const handleCanvasMouseDown = useCallback(event => {\n    if (!canvasRef.current) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const scaleX = 128 / rect.width;\n    const scaleY = 64 / rect.height;\n    const x = Math.floor((event.clientX - rect.left) * scaleX);\n    const y = Math.floor((event.clientY - rect.top) * scaleY);\n    if (x >= 0 && x < 128 && y >= 0 && y < 64) {\n      const index = y * 128 + x;\n      currentIndexRef.current = index;\n      handleMouseDown(index);\n    }\n  }, []);\n  const handleCanvasMouseMove = useCallback(event => {\n    if (!canvasRef.current) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const scaleX = 128 / rect.width;\n    const scaleY = 64 / rect.height;\n    const x = Math.floor((event.clientX - rect.left) * scaleX);\n    const y = Math.floor((event.clientY - rect.top) * scaleY);\n    if (x >= 0 && x < 128 && y >= 0 && y < 64) {\n      const index = y * 128 + x;\n      currentIndexRef.current = index;\n\n      // Drawing logic\n      if (isDrawingRef.current || isSpacePressed) {\n        handleMouseEnter(index);\n      }\n\n      // Update brush outline\n      updateBrushOutline(x, y);\n    }\n  }, [isSpacePressed]);\n\n  // Function to update brush outline\n  const updateBrushOutline = (pixelX, pixelY) => {\n    if (!outlineRef.current || !isFreeformActive) return;\n    const rect = canvasRef.current.getBoundingClientRect();\n    const pixelSize = rect.width / 128; // Calculate pixel size\n\n    if (brushSize === 1) {\n      // Simple outline for single pixel brush\n      outlineRef.current.style.display = 'block';\n      outlineRef.current.style.left = `${pixelX * pixelSize}px`;\n      outlineRef.current.style.top = `${pixelY * pixelSize}px`;\n      outlineRef.current.style.width = `${pixelSize}px`;\n      outlineRef.current.style.height = `${pixelSize}px`;\n      outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\n    } else {\n      // Outline for larger brushes\n      const minX = Math.max(0, pixelX - brushSize + 1);\n      const minY = Math.max(0, pixelY - brushSize + 1);\n      const maxX = Math.min(127, pixelX + brushSize - 1);\n      const maxY = Math.min(63, pixelY + brushSize - 1);\n      outlineRef.current.style.display = 'block';\n      outlineRef.current.style.left = `${minX * pixelSize}px`;\n      outlineRef.current.style.top = `${minY * pixelSize}px`;\n      outlineRef.current.style.width = `${(maxX - minX + 1) * pixelSize}px`;\n      outlineRef.current.style.height = `${(maxY - minY + 1) * pixelSize}px`;\n      outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pixel-grid-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"esp32-container\",\n      style: {\n        position: 'fixed',\n        top: '10px',\n        left: '10px',\n        zIndex: 1000\n      },\n      children: /*#__PURE__*/_jsxDEV(ESP32Connection, {\n        pixelData: pixels\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 530,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bmp-container\",\n      style: {\n        position: 'fixed',\n        top: '10px',\n        right: '10px',\n        zIndex: 1000\n      },\n      children: /*#__PURE__*/_jsxDEV(BMPHandler, {\n        pixelData: pixels,\n        onPixelUpdate: setPixels\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 533,\n      columnNumber: 7\n    }, this), isFreeformActive && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"brush-size-control\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"brushSize\",\n        style: {\n          color: 'white',\n          minWidth: '100px'\n        },\n        children: [\"Brush Size: \", brushSize]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        id: \"brushSize\",\n        className: \"brush-size-slider\",\n        min: \"1\",\n        max: \"5\",\n        value: brushSize,\n        onChange: e => setBrushSize(Number(e.target.value))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 548,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 544,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mode-buttons-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsLineModeActive(false);\n          setIsCircleModeActive(false);\n          setIsBucketFillModeActive(false);\n          setIsRectangleModeActive(false);\n          setPreviewPixels(Array(8192).fill(false));\n        },\n        className: `mode-button ${isFreeformActive ? 'active' : ''}`,\n        children: freeformMode.modeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 562,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsLineModeActive(true);\n          setIsCircleModeActive(false);\n          setIsBucketFillModeActive(false);\n          setIsRectangleModeActive(false);\n        },\n        className: `mode-button ${isLineModeActive ? 'active' : ''}`,\n        children: lineMode.modeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 574,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsLineModeActive(false);\n          setIsCircleModeActive(true);\n          setIsBucketFillModeActive(false);\n          setIsRectangleModeActive(false);\n        },\n        className: `mode-button ${isCircleModeActive ? 'active' : ''}`,\n        children: circleMode.modeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 585,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsLineModeActive(false);\n          setIsCircleModeActive(false);\n          setIsBucketFillModeActive(false);\n          setIsRectangleModeActive(true);\n        },\n        className: `mode-button ${isRectangleModeActive ? 'active' : ''}`,\n        children: rectangleMode.modeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 596,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsLineModeActive(false);\n          setIsCircleModeActive(false);\n          setIsBucketFillModeActive(true);\n          setIsRectangleModeActive(false);\n        },\n        className: `mode-button ${isBucketFillModeActive ? 'active' : ''}`,\n        children: bucketFillMode.modeName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 607,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleUndo,\n        className: \"mode-button\",\n        disabled: !canUndo,\n        style: {\n          marginLeft: 'auto'\n        },\n        children: \"Undo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 618,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleRedo,\n        className: \"mode-button\",\n        disabled: !canRedo,\n        children: \"Redo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 626,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 561,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative',\n        width: '1024px',\n        height: '512px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          left: '-34px',\n          top: 0,\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center',\n          height: '100%',\n          justifyContent: 'center',\n          zIndex: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => setDrawColor(true),\n          style: {\n            width: '24px',\n            height: '24px',\n            backgroundColor: '#fff',\n            border: drawColor ? '2px solid #2196F3' : '1px solid #666',\n            marginBottom: '10px',\n            cursor: 'pointer',\n            boxSizing: 'border-box'\n          },\n          title: \"White (Draw)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 649,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => setDrawColor(false),\n          style: {\n            width: '24px',\n            height: '24px',\n            backgroundColor: '#000',\n            border: !drawColor ? '2px solid red' : '1px solid #666',\n            cursor: 'pointer',\n            boxSizing: 'border-box'\n          },\n          title: \"Black (Eraser)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 662,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 638,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"canvas-container\",\n        style: {\n          position: 'relative'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          width: \"1024\",\n          height: \"512\",\n          style: {\n            display: 'block',\n            backgroundColor: '#222',\n            border: '1px solid #444',\n            imageRendering: 'pixelated'\n          },\n          onMouseDown: handleCanvasMouseDown,\n          onMouseMove: handleCanvasMouseMove,\n          onMouseUp: handleMouseUp,\n          onMouseLeave: handleMouseUp\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 678,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"brush-outline\",\n          ref: outlineRef,\n          style: {\n            position: 'absolute',\n            pointerEvents: 'none',\n            zIndex: 100,\n            display: 'none',\n            borderColor: drawColor ? 'white' : 'red'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 693,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 677,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 636,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ResetButton, {\n      onReset: handleReset\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 706,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 522,\n    columnNumber: 5\n  }, this);\n};\n_s2(PixelGrid, \"TmJHNC4L2zj5oDXURmVtMHbk88E=\", false, function () {\n  return [useOffscreenCanvas, useUndoRedo];\n});\n_c = PixelGrid;\nexport default PixelGrid;\nvar _c;\n$RefreshReg$(_c, \"PixelGrid\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","useMemo","FreeformMode","LineMode","ResetButton","getCoordinates","CircleMode","BucketFillMode","useUndoRedo","RectangleMode","ESP32Connection","BMPHandler","jsxDEV","_jsxDEV","useOffscreenCanvas","_s","canvasRef","canvas","document","createElement","width","height","current","PixelGrid","_s2","pixels","setPixels","Array","fill","isLineModeActive","setIsLineModeActive","isCircleModeActive","setIsCircleModeActive","isBucketFillModeActive","setIsBucketFillModeActive","isRectangleModeActive","setIsRectangleModeActive","previewPixels","setPreviewPixels","offscreenCanvasRef","isDrawingRef","startPointRef","lastPointRef","isSpacePressed","setIsSpacePressed","currentIndexRef","brushSize","setBrushSize","drawColor","setDrawColor","rafRef","pendingUpdatesRef","outlineRef","addToHistory","undo","redo","canUndo","canRedo","renderCanvas","ctx","getContext","alpha","fillStyle","fillRect","y","x","idx","visibleCtx","imageSmoothingEnabled","drawImage","batchPixelUpdate","updateFn","requestAnimationFrame","prevPixels","batchPreviewUpdate","updateCanvasSize","window","addEventListener","removeEventListener","handleKeyDown","e","code","preventDefault","handleMouseDown","ctrlKey","metaKey","key","toLowerCase","shiftKey","handleRedo","handleUndo","handleKeyUp","handleMouseUp","cancelAnimationFrame","handlePixelUpdate","previousState","nextState","isFreeformActive","freeformMode","isActive","onPixelUpdate","lineMode","onPreviewUpdate","circleMode","bucketFillMode","rectangleMode","index","handleFill","point","handleStart","handleMouseEnter","handleDraw","handlePreview","endIndex","updatedPixels","handleCommit","linePoints","forEach","circlePoints","rectanglePoints","handleReset","newState","handlePixelHover","cursorStyle","handleMouseMove","rect","querySelector","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","pixelX","Math","floor","pixelY","currentIndex","innerHTML","style","display","border","borderRadius","minX","max","minY","maxX","min","maxY","grid","passive","pixelChunks","chunks","chunkSize","i","length","push","slice","handlePixelClick","event","console","log","handleCanvasMouseDown","scaleX","scaleY","handleCanvasMouseMove","updateBrushOutline","pixelSize","className","children","position","zIndex","pixelData","fileName","_jsxFileName","lineNumber","columnNumber","right","htmlFor","color","minWidth","type","id","value","onChange","Number","target","onClick","modeName","disabled","marginLeft","flexDirection","alignItems","justifyContent","backgroundColor","marginBottom","cursor","boxSizing","title","ref","imageRendering","onMouseDown","onMouseMove","onMouseUp","onMouseLeave","pointerEvents","borderColor","onReset","_c","$RefreshReg$"],"sources":["C:/Users/wikx3/Documents/VS_code/React/AOD/src/components/pixelGrid/index.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback, useMemo } from 'react';\r\nimport FreeformMode from './FreeFormMode';\r\nimport LineMode from './LineMode';\r\nimport ResetButton from './ResetButton';\r\nimport { getCoordinates } from './utils';\r\nimport CircleMode from './CircleMode';\r\nimport BucketFillMode from './BucketFillMode';\r\nimport { useUndoRedo } from './useUndoRedo';\r\nimport RectangleMode from './RectangleMode';\r\nimport ESP32Connection from '../ESP32Connection';\r\nimport BMPHandler from '../BMPHandler';\r\n\r\n// Performance optimization - use off-screen canvas for rendering\r\nconst useOffscreenCanvas = () => {\r\n  const canvasRef = useRef(null);\r\n  \r\n  useEffect(() => {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = 128;\r\n    canvas.height = 64;\r\n    canvasRef.current = canvas;\r\n  }, []);\r\n  \r\n  return canvasRef;\r\n};\r\n\r\n// Pixel component is causing performance issues - remove and use direct canvas rendering instead\r\nconst PixelGrid = () => {\r\n  const [pixels, setPixels] = useState(Array(8192).fill(false));\r\n  const [isLineModeActive, setIsLineModeActive] = useState(false);\r\n  const [isCircleModeActive, setIsCircleModeActive] = useState(false);\r\n  const [isBucketFillModeActive, setIsBucketFillModeActive] = useState(false);\r\n  const [isRectangleModeActive, setIsRectangleModeActive] = useState(false);\r\n  const [previewPixels, setPreviewPixels] = useState(Array(8192).fill(false));\r\n  const canvasRef = useRef(null);\r\n  const offscreenCanvasRef = useOffscreenCanvas();\r\n  const isDrawingRef = useRef(false);\r\n  const startPointRef = useRef(null);\r\n  const lastPointRef = useRef(null);\r\n  const [isSpacePressed, setIsSpacePressed] = useState(false);\r\n  const currentIndexRef = useRef(null);\r\n  const [brushSize, setBrushSize] = useState(1);\r\n  const [drawColor, setDrawColor] = useState(true); // true for white, false for black\r\n  const rafRef = useRef(null); // For requestAnimationFrame\r\n  const pendingUpdatesRef = useRef(null); // Store pending pixel updates\r\n  const outlineRef = useRef(null);\r\n  \r\n  const { addToHistory, undo, redo, canUndo, canRedo } = useUndoRedo(Array(8192).fill(false));\r\n\r\n  // Function to render pixels to canvas - critical for performance\r\n  const renderCanvas = useCallback(() => {\r\n    if (!canvasRef.current || !offscreenCanvasRef.current) return;\r\n    \r\n    const ctx = offscreenCanvasRef.current.getContext('2d', { alpha: false });\r\n    ctx.fillStyle = '#000000'; // Black background\r\n    ctx.fillRect(0, 0, 128, 64);\r\n    \r\n    // Draw white pixels\r\n    ctx.fillStyle = '#FFFFFF';\r\n    for (let y = 0; y < 64; y++) {\r\n      for (let x = 0; x < 128; x++) {\r\n        const idx = y * 128 + x;\r\n        if (previewPixels[idx] === true || (pixels[idx] === true && previewPixels[idx] !== 'black-preview')) {\r\n          ctx.fillRect(x, y, 1, 1);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Scale and draw to visible canvas\r\n    const visibleCtx = canvasRef.current.getContext('2d', { alpha: false });\r\n    visibleCtx.imageSmoothingEnabled = false;\r\n    visibleCtx.drawImage(\r\n      offscreenCanvasRef.current, \r\n      0, 0, 128, 64, \r\n      0, 0, canvasRef.current.width, canvasRef.current.height\r\n    );\r\n  }, [pixels, previewPixels]);\r\n  \r\n  // Batch update pixels with requestAnimationFrame for better performance\r\n  const batchPixelUpdate = useCallback((updateFn) => {\r\n    if (rafRef.current) return; // Already have a pending update\r\n    \r\n    pendingUpdatesRef.current = updateFn;\r\n    \r\n    rafRef.current = requestAnimationFrame(() => {\r\n      if (pendingUpdatesRef.current) {\r\n        setPixels(prevPixels => pendingUpdatesRef.current(prevPixels));\r\n        pendingUpdatesRef.current = null;\r\n      }\r\n      rafRef.current = null;\r\n    });\r\n  }, []);\r\n\r\n  // Fix: Define and use batchPreviewUpdate\r\n  const batchPreviewUpdate = useCallback((updateFn) => {\r\n    if (!updateFn) return;\r\n    requestAnimationFrame(() => {\r\n      setPreviewPixels(updateFn);\r\n    });\r\n  }, []);\r\n\r\n  // Update canvas when pixels or preview changes\r\n  useEffect(() => {\r\n    if (canvasRef.current) {\r\n      renderCanvas();\r\n    }\r\n  }, [pixels, previewPixels, renderCanvas]);\r\n\r\n  // Initialize canvas size on mount\r\n  useEffect(() => {\r\n    if (canvasRef.current) {\r\n      const updateCanvasSize = () => {\r\n        canvasRef.current.width = 1024;\r\n        canvasRef.current.height = 512;\r\n        renderCanvas();\r\n      };\r\n      \r\n      updateCanvasSize();\r\n      window.addEventListener('resize', updateCanvasSize);\r\n      \r\n      return () => {\r\n        window.removeEventListener('resize', updateCanvasSize);\r\n      };\r\n    }\r\n  }, [renderCanvas]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (e.code === 'Space' && !isSpacePressed && currentIndexRef.current !== null) {\r\n        e.preventDefault();\r\n        setIsSpacePressed(true);\r\n        handleMouseDown(currentIndexRef.current);\r\n      } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'z') {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          // Handle Ctrl+Shift+Z (Windows) or Cmd+Shift+Z (Mac)\r\n          handleRedo();\r\n        } else {\r\n          // Handle Ctrl+Z (Windows) or Cmd+Z (Mac)\r\n          handleUndo();\r\n        }\r\n      } else if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\r\n        // Add alternative redo shortcut (Ctrl+Y)\r\n        e.preventDefault();\r\n        handleRedo();\r\n      } else if (e.key === 'b') {\r\n        // Shortcut for brush (freeform)\r\n        e.preventDefault();\r\n        setIsLineModeActive(false);\r\n        setIsCircleModeActive(false);\r\n        setIsBucketFillModeActive(false);\r\n      }\r\n    };\r\n\r\n    const handleKeyUp = (e) => {\r\n      if (e.code === 'Space') {\r\n        e.preventDefault();\r\n        setIsSpacePressed(false);\r\n        // Add state to history when space drawing ends\r\n        if (isDrawingRef.current) {\r\n          addToHistory([...pixels]);\r\n        }\r\n        handleMouseUp();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    window.addEventListener('keyup', handleKeyUp);\r\n\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, [isSpacePressed, pixels, addToHistory]); // Add dependencies\r\n\r\n  // Clean up RAF on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (rafRef.current) {\r\n        cancelAnimationFrame(rafRef.current);\r\n        rafRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handlePixelUpdate = useCallback((updateFn) => {\r\n    batchPixelUpdate(updateFn);\r\n  }, [batchPixelUpdate]);\r\n\r\n  const handleUndo = () => {\r\n    const previousState = undo();\r\n    if (previousState) {\r\n      setPixels(previousState);\r\n    }\r\n  };\r\n\r\n  const handleRedo = () => {\r\n    const nextState = redo();\r\n    if (nextState) {\r\n      setPixels(nextState);\r\n    }\r\n  };\r\n\r\n  // Use useMemo to calculate active mode only when dependencies change\r\n  const isFreeformActive = useMemo(() => {\r\n    return !isLineModeActive && !isCircleModeActive && \r\n           !isBucketFillModeActive && !isRectangleModeActive;\r\n  }, [isLineModeActive, isCircleModeActive, isBucketFillModeActive, isRectangleModeActive]);\r\n\r\n  // Use useMemo for these mode objects to avoid re-creating on every render\r\n  const freeformMode = useMemo(() => FreeformMode({\r\n    isActive: isFreeformActive,\r\n    onPixelUpdate: handlePixelUpdate,\r\n    brushSize,\r\n    drawColor\r\n  }), [isFreeformActive, handlePixelUpdate, brushSize, drawColor]);\r\n\r\n  const lineMode = useMemo(() => LineMode({\r\n    isActive: isLineModeActive,\r\n    onPixelUpdate: handlePixelUpdate,\r\n    onPreviewUpdate: batchPreviewUpdate, // Properly pass batchPreviewUpdate\r\n    drawColor\r\n  }), [isLineModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\r\n\r\n  const circleMode = useMemo(() => CircleMode({\r\n    isActive: isCircleModeActive,\r\n    onPixelUpdate: handlePixelUpdate,\r\n    onPreviewUpdate: batchPreviewUpdate, // Properly pass batchPreviewUpdate\r\n    drawColor\r\n  }), [isCircleModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\r\n\r\n  const bucketFillMode = useMemo(() => BucketFillMode({\r\n    isActive: isBucketFillModeActive,\r\n    onPixelUpdate: handlePixelUpdate,\r\n    drawColor\r\n  }), [isBucketFillModeActive, handlePixelUpdate, drawColor]);\r\n\r\n  const rectangleMode = useMemo(() => RectangleMode({\r\n    isActive: isRectangleModeActive,\r\n    onPixelUpdate: handlePixelUpdate,\r\n    onPreviewUpdate: batchPreviewUpdate, // Properly pass batchPreviewUpdate\r\n    drawColor\r\n  }), [isRectangleModeActive, handlePixelUpdate, batchPreviewUpdate, drawColor]);\r\n\r\n  const handleMouseDown = useCallback((index) => {\r\n    isDrawingRef.current = true;\r\n    \r\n    if (isBucketFillModeActive) {\r\n      // For bucket fill, execute fill immediately\r\n      bucketFillMode.handleFill(index, pixels);\r\n      addToHistory([...pixels]);\r\n      isDrawingRef.current = false;\r\n      return;\r\n    }\r\n    \r\n    if (isFreeformActive) {\r\n      // For freeform mode, draw immediately on click\r\n      const point = getCoordinates(index);\r\n      lastPointRef.current = point;\r\n      freeformMode.handleStart(index);\r\n    } else {\r\n      startPointRef.current = getCoordinates(index);\r\n      lastPointRef.current = getCoordinates(index);\r\n    }\r\n  }, [pixels, bucketFillMode, isBucketFillModeActive, isFreeformActive, freeformMode, addToHistory]);\r\n\r\n  const handleMouseEnter = useCallback((index) => {\r\n    if (!isDrawingRef.current) return;\r\n    \r\n    if (isFreeformActive) {\r\n      // For freeform mode\r\n      lastPointRef.current = freeformMode.handleDraw(lastPointRef.current, index);\r\n    } else if (isLineModeActive) {\r\n      // For line mode\r\n      lineMode.handlePreview(startPointRef.current, index);\r\n      lastPointRef.current = getCoordinates(index);\r\n    } else if (isCircleModeActive) {\r\n      // For circle mode\r\n      circleMode.handlePreview(startPointRef.current, index);\r\n      lastPointRef.current = getCoordinates(index);\r\n    } else if (isRectangleModeActive) {\r\n      // For rectangle mode\r\n      rectangleMode.handlePreview(startPointRef.current, index);\r\n      lastPointRef.current = getCoordinates(index);\r\n    }\r\n  }, [isFreeformActive, freeformMode, isLineModeActive, lineMode, isCircleModeActive, circleMode, isRectangleModeActive, rectangleMode]);\r\n\r\n  const handleMouseUp = useCallback(() => {\r\n    if (isDrawingRef.current) {\r\n      if ((isLineModeActive || isCircleModeActive || isRectangleModeActive) && \r\n          startPointRef.current && lastPointRef.current) {\r\n        \r\n        const endIndex = lastPointRef.current.y * 128 + lastPointRef.current.x;\r\n        let updatedPixels = [...pixels];\r\n        \r\n        if (isLineModeActive && lineMode.handleCommit) {\r\n          const linePoints = lineMode.handleCommit(startPointRef.current, endIndex);\r\n          if (linePoints) {\r\n            linePoints.forEach(idx => {\r\n              updatedPixels[idx] = drawColor;\r\n            });\r\n          }\r\n        } else if (isCircleModeActive && circleMode.handleCommit) {\r\n          const circlePoints = circleMode.handleCommit(startPointRef.current, endIndex);\r\n          if (circlePoints) {\r\n            circlePoints.forEach(idx => {\r\n              updatedPixels[idx] = drawColor;\r\n            });\r\n          }\r\n        } else if (isRectangleModeActive && rectangleMode.handleCommit) {\r\n          const rectanglePoints = rectangleMode.handleCommit(startPointRef.current, endIndex);\r\n          if (rectanglePoints) {\r\n            rectanglePoints.forEach(idx => {\r\n              updatedPixels[idx] = drawColor;\r\n            });\r\n          }\r\n        }\r\n        \r\n        setPixels(updatedPixels);\r\n        setPreviewPixels(Array(8192).fill(false));\r\n        addToHistory(updatedPixels);\r\n      } else if (!isBucketFillModeActive) {\r\n        // For freeform, only save on mouse up\r\n        addToHistory([...pixels]);\r\n      }\r\n    }\r\n    \r\n    isDrawingRef.current = false;\r\n    startPointRef.current = null;\r\n    lastPointRef.current = null;\r\n  }, [pixels, isLineModeActive, isCircleModeActive, isRectangleModeActive, isBucketFillModeActive, lineMode, circleMode, rectangleMode, drawColor, addToHistory]);\r\n\r\n  const handleReset = useCallback(() => {\r\n    const newState = Array(8192).fill(false);\r\n    setPixels(newState);\r\n    setPreviewPixels(Array(8192).fill(false));\r\n    startPointRef.current = null;\r\n    lastPointRef.current = null;\r\n    isDrawingRef.current = false;\r\n    addToHistory(newState);\r\n  }, [addToHistory]);\r\n\r\n  const handlePixelHover = useCallback((index) => {\r\n    currentIndexRef.current = index;\r\n    if (isDrawingRef.current || isSpacePressed) {\r\n      handleMouseEnter(index);\r\n    }\r\n  }, [isSpacePressed, handleMouseEnter]);\r\n\r\n  // Use this cursor style for better performance (avoid style recalculations)\r\n  const cursorStyle = useMemo(() => {\r\n    if (isFreeformActive) return 'none';\r\n    if (isBucketFillModeActive) return 'cell';\r\n    return 'crosshair';\r\n  }, [isFreeformActive, isBucketFillModeActive]);\r\n\r\n  // Add brush outline effect\r\n  useEffect(() => {\r\n    const handleMouseMove = (e) => {\r\n      if (!outlineRef.current) return;\r\n      \r\n      // Only show outline for freeform mode\r\n      if (isFreeformActive) {\r\n        const rect = document.querySelector('.pixel-grid').getBoundingClientRect();\r\n        const mouseX = e.clientX - rect.left;\r\n        const mouseY = e.clientY - rect.top;\r\n        \r\n        // Calculate which pixel we're hovering over\r\n        const pixelX = Math.floor(mouseX / 8);\r\n        const pixelY = Math.floor(mouseY / 8);\r\n        \r\n        // Store the current pixel index for consistent drawing\r\n        const currentIndex = pixelY * 128 + pixelX;\r\n        currentIndexRef.current = currentIndex;\r\n        \r\n        if (brushSize === 1) {\r\n          // For brush size 1, just show a simple pixel outline\r\n          if (pixelX >= 0 && pixelX < 128 && pixelY >= 0 && pixelY < 64) {\r\n            outlineRef.current.innerHTML = '';\r\n            outlineRef.current.style.left = `${pixelX * 8}px`;\r\n            outlineRef.current.style.top = `${pixelY * 8}px`;\r\n            outlineRef.current.style.width = `8px`;\r\n            outlineRef.current.style.height = `8px`;\r\n            outlineRef.current.style.display = 'block';\r\n            outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\r\n            outlineRef.current.style.borderRadius = '0'; // Ensure square shape\r\n          }\r\n        } else {\r\n          // Instead of creating a canvas each time, use pre-calculated DOM elements\r\n          // This is much more efficient\r\n          outlineRef.current.style.display = 'block';\r\n          outlineRef.current.innerHTML = '';\r\n          \r\n          const minX = Math.max(0, pixelX - brushSize + 1);\r\n          const minY = Math.max(0, pixelY - brushSize + 1);\r\n          const maxX = Math.min(127, pixelX + brushSize - 1);\r\n          const maxY = Math.min(63, pixelY + brushSize - 1);\r\n          \r\n          outlineRef.current.style.left = `${minX * 8}px`;\r\n          outlineRef.current.style.top = `${minY * 8}px`;\r\n          outlineRef.current.style.width = `${(maxX - minX + 1) * 8}px`;\r\n          outlineRef.current.style.height = `${(maxY - minY + 1) * 8}px`;\r\n          outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\r\n        }\r\n      } else {\r\n        outlineRef.current.style.display = 'none';\r\n      }\r\n    };\r\n    \r\n    const grid = document.querySelector('.pixel-grid');\r\n    if (grid) {\r\n      grid.addEventListener('mousemove', handleMouseMove, { passive: true });\r\n    }\r\n    \r\n    return () => {\r\n      if (grid) {\r\n        grid.removeEventListener('mousemove', handleMouseMove);\r\n      }\r\n    };\r\n  }, [brushSize, isFreeformActive, drawColor]);\r\n\r\n  // Use a more efficient approach to render pixels\r\n  // Create chunks of pixels to reduce the number of individual components\r\n  const pixelChunks = useMemo(() => {\r\n    const chunks = [];\r\n    // Generate chunks - each chunk contains 100 pixels\r\n    const chunkSize = 800;\r\n    for (let i = 0; i < pixels.length; i += chunkSize) {\r\n      chunks.push(pixels.slice(i, i + chunkSize));\r\n    }\r\n    return chunks;\r\n  }, [pixels]);\r\n\r\n  // Centralize the click handler to avoid recreating it for every pixel\r\n  const handlePixelClick = useCallback((event) => {\r\n    event.preventDefault();\r\n    \r\n    if (!currentIndexRef.current && currentIndexRef.current !== 0) return;\r\n    \r\n    handleMouseDown(currentIndexRef.current);\r\n  }, [handleMouseDown]);\r\n\r\n  // Fix - Check if the grid is rendered\r\n  useEffect(() => {\r\n    console.log(\"Grid should contain:\", pixels.length, \"pixels\");\r\n    const grid = document.querySelector('.pixel-grid');\r\n    console.log(\"Grid element exists:\", !!grid);\r\n  }, []);\r\n\r\n  // Handle mouse events on canvas instead of individual divs\r\n  const handleCanvasMouseDown = useCallback((event) => {\r\n    if (!canvasRef.current) return;\r\n    \r\n    const rect = canvasRef.current.getBoundingClientRect();\r\n    const scaleX = 128 / rect.width;\r\n    const scaleY = 64 / rect.height;\r\n    const x = Math.floor((event.clientX - rect.left) * scaleX);\r\n    const y = Math.floor((event.clientY - rect.top) * scaleY);\r\n    \r\n    if (x >= 0 && x < 128 && y >= 0 && y < 64) {\r\n      const index = y * 128 + x;\r\n      currentIndexRef.current = index;\r\n      handleMouseDown(index);\r\n    }\r\n  }, []);\r\n  \r\n  const handleCanvasMouseMove = useCallback((event) => {\r\n    if (!canvasRef.current) return;\r\n    \r\n    const rect = canvasRef.current.getBoundingClientRect();\r\n    const scaleX = 128 / rect.width;\r\n    const scaleY = 64 / rect.height;\r\n    const x = Math.floor((event.clientX - rect.left) * scaleX);\r\n    const y = Math.floor((event.clientY - rect.top) * scaleY);\r\n    \r\n    if (x >= 0 && x < 128 && y >= 0 && y < 64) {\r\n      const index = y * 128 + x;\r\n      currentIndexRef.current = index;\r\n      \r\n      // Drawing logic\r\n      if (isDrawingRef.current || isSpacePressed) {\r\n        handleMouseEnter(index);\r\n      }\r\n      \r\n      // Update brush outline\r\n      updateBrushOutline(x, y);\r\n    }\r\n  }, [isSpacePressed]);\r\n\r\n  // Function to update brush outline\r\n  const updateBrushOutline = (pixelX, pixelY) => {\r\n    if (!outlineRef.current || !isFreeformActive) return;\r\n    \r\n    const rect = canvasRef.current.getBoundingClientRect();\r\n    const pixelSize = rect.width / 128; // Calculate pixel size\r\n    \r\n    if (brushSize === 1) {\r\n      // Simple outline for single pixel brush\r\n      outlineRef.current.style.display = 'block';\r\n      outlineRef.current.style.left = `${pixelX * pixelSize}px`;\r\n      outlineRef.current.style.top = `${pixelY * pixelSize}px`;\r\n      outlineRef.current.style.width = `${pixelSize}px`;\r\n      outlineRef.current.style.height = `${pixelSize}px`;\r\n      outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\r\n    } else {\r\n      // Outline for larger brushes\r\n      const minX = Math.max(0, pixelX - brushSize + 1);\r\n      const minY = Math.max(0, pixelY - brushSize + 1);\r\n      const maxX = Math.min(127, pixelX + brushSize - 1);\r\n      const maxY = Math.min(63, pixelY + brushSize - 1);\r\n      \r\n      outlineRef.current.style.display = 'block';\r\n      outlineRef.current.style.left = `${minX * pixelSize}px`;\r\n      outlineRef.current.style.top = `${minY * pixelSize}px`;\r\n      outlineRef.current.style.width = `${(maxX - minX + 1) * pixelSize}px`;\r\n      outlineRef.current.style.height = `${(maxY - minY + 1) * pixelSize}px`;\r\n      outlineRef.current.style.border = `1px solid ${drawColor ? 'white' : 'red'}`;\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"pixel-grid-container\">\r\n      {/* ESP32 and BMP Handler buttons */}\r\n      <div className=\"esp32-container\" style={{ \r\n        position: 'fixed', \r\n        top: '10px', \r\n        left: '10px', \r\n        zIndex: 1000 \r\n      }}>\r\n        <ESP32Connection pixelData={pixels} />\r\n      </div>\r\n      \r\n      <div className=\"bmp-container\" style={{ \r\n        position: 'fixed', \r\n        top: '10px', \r\n        right: '10px', \r\n        zIndex: 1000 \r\n      }}>\r\n        <BMPHandler pixelData={pixels} onPixelUpdate={setPixels} />\r\n      </div>\r\n\r\n      {/* Brush size control */}\r\n      {isFreeformActive && (\r\n        <div className=\"brush-size-control\">\r\n          <label htmlFor=\"brushSize\" style={{ color: 'white', minWidth: '100px' }}>\r\n            Brush Size: {brushSize}\r\n          </label>\r\n          <input\r\n            type=\"range\"\r\n            id=\"brushSize\"\r\n            className=\"brush-size-slider\"\r\n            min=\"1\"\r\n            max=\"5\"\r\n            value={brushSize}\r\n            onChange={(e) => setBrushSize(Number(e.target.value))}\r\n          />\r\n        </div>\r\n      )}\r\n      \r\n      {/* Mode buttons */}\r\n      <div className=\"mode-buttons-container\">\r\n        <button \r\n          onClick={() => {\r\n            setIsLineModeActive(false);\r\n            setIsCircleModeActive(false);\r\n            setIsBucketFillModeActive(false);\r\n            setIsRectangleModeActive(false);\r\n            setPreviewPixels(Array(8192).fill(false));\r\n          }}\r\n          className={`mode-button ${isFreeformActive ? 'active' : ''}`}\r\n        >\r\n          {freeformMode.modeName}\r\n        </button>\r\n        <button \r\n          onClick={() => {\r\n            setIsLineModeActive(true);\r\n            setIsCircleModeActive(false);\r\n            setIsBucketFillModeActive(false);\r\n            setIsRectangleModeActive(false);\r\n          }}\r\n          className={`mode-button ${isLineModeActive ? 'active' : ''}`}\r\n        >\r\n          {lineMode.modeName}\r\n        </button>\r\n        <button \r\n          onClick={() => {\r\n            setIsLineModeActive(false);\r\n            setIsCircleModeActive(true);\r\n            setIsBucketFillModeActive(false);\r\n            setIsRectangleModeActive(false);\r\n          }}\r\n          className={`mode-button ${isCircleModeActive ? 'active' : ''}`}\r\n        >\r\n          {circleMode.modeName}\r\n        </button>\r\n        <button \r\n          onClick={() => {\r\n            setIsLineModeActive(false);\r\n            setIsCircleModeActive(false);\r\n            setIsBucketFillModeActive(false);\r\n            setIsRectangleModeActive(true);\r\n          }}\r\n          className={`mode-button ${isRectangleModeActive ? 'active' : ''}`}\r\n        >\r\n          {rectangleMode.modeName}\r\n        </button>\r\n        <button \r\n          onClick={() => {\r\n            setIsLineModeActive(false);\r\n            setIsCircleModeActive(false);\r\n            setIsBucketFillModeActive(true);\r\n            setIsRectangleModeActive(false);\r\n          }}\r\n          className={`mode-button ${isBucketFillModeActive ? 'active' : ''}`}\r\n        >\r\n          {bucketFillMode.modeName}\r\n        </button>\r\n        <button \r\n          onClick={handleUndo}\r\n          className=\"mode-button\"\r\n          disabled={!canUndo}\r\n          style={{ marginLeft: 'auto' }}\r\n        >\r\n          Undo\r\n        </button>\r\n        <button \r\n          onClick={handleRedo}\r\n          className=\"mode-button\"\r\n          disabled={!canRedo}\r\n        >\r\n          Redo\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Drawing area */}\r\n      <div style={{ position: 'relative', width: '1024px', height: '512px' }}>\r\n        {/* Color selection buttons */}\r\n        <div style={{\r\n          position: 'absolute',\r\n          left: '-34px',\r\n          top: 0,\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          alignItems: 'center',\r\n          height: '100%',\r\n          justifyContent: 'center',\r\n          zIndex: 1\r\n        }}>\r\n          <div \r\n            onClick={() => setDrawColor(true)}\r\n            style={{\r\n              width: '24px',\r\n              height: '24px',\r\n              backgroundColor: '#fff',\r\n              border: drawColor ? '2px solid #2196F3' : '1px solid #666',\r\n              marginBottom: '10px',\r\n              cursor: 'pointer',\r\n              boxSizing: 'border-box'\r\n            }}\r\n            title=\"White (Draw)\"\r\n          />\r\n          <div \r\n            onClick={() => setDrawColor(false)}\r\n            style={{\r\n              width: '24px',\r\n              height: '24px',\r\n              backgroundColor: '#000',\r\n              border: !drawColor ? '2px solid red' : '1px solid #666',\r\n              cursor: 'pointer',\r\n              boxSizing: 'border-box'\r\n            }}\r\n            title=\"Black (Eraser)\"\r\n          />\r\n        </div>\r\n        \r\n        {/* Canvas-based drawing area (replacing the grid of individual divs) */}\r\n        <div className=\"canvas-container\" style={{ position: 'relative' }}>\r\n          <canvas\r\n            ref={canvasRef}\r\n            width=\"1024\"\r\n            height=\"512\"\r\n            style={{\r\n              display: 'block',\r\n              backgroundColor: '#222', \r\n              border: '1px solid #444',\r\n              imageRendering: 'pixelated'\r\n            }}\r\n            onMouseDown={handleCanvasMouseDown}\r\n            onMouseMove={handleCanvasMouseMove}\r\n            onMouseUp={handleMouseUp}\r\n            onMouseLeave={handleMouseUp}\r\n          />\r\n          <div \r\n            className=\"brush-outline\" \r\n            ref={outlineRef}\r\n            style={{ \r\n              position: 'absolute',\r\n              pointerEvents: 'none',\r\n              zIndex: 100,\r\n              display: 'none',\r\n              borderColor: drawColor ? 'white' : 'red'\r\n            }}\r\n          ></div>\r\n        </div>\r\n      </div>\r\n      <ResetButton onReset={handleReset} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PixelGrid;"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,WAAW,EAAEC,OAAO,QAAQ,OAAO;AAChF,OAAOC,YAAY,MAAM,gBAAgB;AACzC,OAAOC,QAAQ,MAAM,YAAY;AACjC,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,cAAc,QAAQ,SAAS;AACxC,OAAOC,UAAU,MAAM,cAAc;AACrC,OAAOC,cAAc,MAAM,kBAAkB;AAC7C,SAASC,WAAW,QAAQ,eAAe;AAC3C,OAAOC,aAAa,MAAM,iBAAiB;AAC3C,OAAOC,eAAe,MAAM,oBAAoB;AAChD,OAAOC,UAAU,MAAM,eAAe;;AAEtC;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,kBAAkB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC/B,MAAMC,SAAS,GAAGlB,MAAM,CAAC,IAAI,CAAC;EAE9BC,SAAS,CAAC,MAAM;IACd,MAAMkB,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IAC/CF,MAAM,CAACG,KAAK,GAAG,GAAG;IAClBH,MAAM,CAACI,MAAM,GAAG,EAAE;IAClBL,SAAS,CAACM,OAAO,GAAGL,MAAM;EAC5B,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOD,SAAS;AAClB,CAAC;;AAED;AAAAD,EAAA,CAbMD,kBAAkB;AAcxB,MAAMS,SAAS,GAAGA,CAAA,KAAM;EAAAC,GAAA;EACtB,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAG7B,QAAQ,CAAC8B,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC7D,MAAM,CAACC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGjC,QAAQ,CAAC,KAAK,CAAC;EAC/D,MAAM,CAACkC,kBAAkB,EAAEC,qBAAqB,CAAC,GAAGnC,QAAQ,CAAC,KAAK,CAAC;EACnE,MAAM,CAACoC,sBAAsB,EAAEC,yBAAyB,CAAC,GAAGrC,QAAQ,CAAC,KAAK,CAAC;EAC3E,MAAM,CAACsC,qBAAqB,EAAEC,wBAAwB,CAAC,GAAGvC,QAAQ,CAAC,KAAK,CAAC;EACzE,MAAM,CAACwC,aAAa,EAAEC,gBAAgB,CAAC,GAAGzC,QAAQ,CAAC8B,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC3E,MAAMZ,SAAS,GAAGlB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMyC,kBAAkB,GAAGzB,kBAAkB,CAAC,CAAC;EAC/C,MAAM0B,YAAY,GAAG1C,MAAM,CAAC,KAAK,CAAC;EAClC,MAAM2C,aAAa,GAAG3C,MAAM,CAAC,IAAI,CAAC;EAClC,MAAM4C,YAAY,GAAG5C,MAAM,CAAC,IAAI,CAAC;EACjC,MAAM,CAAC6C,cAAc,EAAEC,iBAAiB,CAAC,GAAG/C,QAAQ,CAAC,KAAK,CAAC;EAC3D,MAAMgD,eAAe,GAAG/C,MAAM,CAAC,IAAI,CAAC;EACpC,MAAM,CAACgD,SAAS,EAAEC,YAAY,CAAC,GAAGlD,QAAQ,CAAC,CAAC,CAAC;EAC7C,MAAM,CAACmD,SAAS,EAAEC,YAAY,CAAC,GAAGpD,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;EAClD,MAAMqD,MAAM,GAAGpD,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;EAC7B,MAAMqD,iBAAiB,GAAGrD,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;EACxC,MAAMsD,UAAU,GAAGtD,MAAM,CAAC,IAAI,CAAC;EAE/B,MAAM;IAAEuD,YAAY;IAAEC,IAAI;IAAEC,IAAI;IAAEC,OAAO;IAAEC;EAAQ,CAAC,GAAGjD,WAAW,CAACmB,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;;EAE3F;EACA,MAAM8B,YAAY,GAAG1D,WAAW,CAAC,MAAM;IACrC,IAAI,CAACgB,SAAS,CAACM,OAAO,IAAI,CAACiB,kBAAkB,CAACjB,OAAO,EAAE;IAEvD,MAAMqC,GAAG,GAAGpB,kBAAkB,CAACjB,OAAO,CAACsC,UAAU,CAAC,IAAI,EAAE;MAAEC,KAAK,EAAE;IAAM,CAAC,CAAC;IACzEF,GAAG,CAACG,SAAS,GAAG,SAAS,CAAC,CAAC;IAC3BH,GAAG,CAACI,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,CAAC;;IAE3B;IACAJ,GAAG,CAACG,SAAS,GAAG,SAAS;IACzB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;MAC3B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,GAAG,EAAEA,CAAC,EAAE,EAAE;QAC5B,MAAMC,GAAG,GAAGF,CAAC,GAAG,GAAG,GAAGC,CAAC;QACvB,IAAI5B,aAAa,CAAC6B,GAAG,CAAC,KAAK,IAAI,IAAKzC,MAAM,CAACyC,GAAG,CAAC,KAAK,IAAI,IAAI7B,aAAa,CAAC6B,GAAG,CAAC,KAAK,eAAgB,EAAE;UACnGP,GAAG,CAACI,QAAQ,CAACE,CAAC,EAAED,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QAC1B;MACF;IACF;;IAEA;IACA,MAAMG,UAAU,GAAGnD,SAAS,CAACM,OAAO,CAACsC,UAAU,CAAC,IAAI,EAAE;MAAEC,KAAK,EAAE;IAAM,CAAC,CAAC;IACvEM,UAAU,CAACC,qBAAqB,GAAG,KAAK;IACxCD,UAAU,CAACE,SAAS,CAClB9B,kBAAkB,CAACjB,OAAO,EAC1B,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EACb,CAAC,EAAE,CAAC,EAAEN,SAAS,CAACM,OAAO,CAACF,KAAK,EAAEJ,SAAS,CAACM,OAAO,CAACD,MACnD,CAAC;EACH,CAAC,EAAE,CAACI,MAAM,EAAEY,aAAa,CAAC,CAAC;;EAE3B;EACA,MAAMiC,gBAAgB,GAAGtE,WAAW,CAAEuE,QAAQ,IAAK;IACjD,IAAIrB,MAAM,CAAC5B,OAAO,EAAE,OAAO,CAAC;;IAE5B6B,iBAAiB,CAAC7B,OAAO,GAAGiD,QAAQ;IAEpCrB,MAAM,CAAC5B,OAAO,GAAGkD,qBAAqB,CAAC,MAAM;MAC3C,IAAIrB,iBAAiB,CAAC7B,OAAO,EAAE;QAC7BI,SAAS,CAAC+C,UAAU,IAAItB,iBAAiB,CAAC7B,OAAO,CAACmD,UAAU,CAAC,CAAC;QAC9DtB,iBAAiB,CAAC7B,OAAO,GAAG,IAAI;MAClC;MACA4B,MAAM,CAAC5B,OAAO,GAAG,IAAI;IACvB,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMoD,kBAAkB,GAAG1E,WAAW,CAAEuE,QAAQ,IAAK;IACnD,IAAI,CAACA,QAAQ,EAAE;IACfC,qBAAqB,CAAC,MAAM;MAC1BlC,gBAAgB,CAACiC,QAAQ,CAAC;IAC5B,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACAxE,SAAS,CAAC,MAAM;IACd,IAAIiB,SAAS,CAACM,OAAO,EAAE;MACrBoC,YAAY,CAAC,CAAC;IAChB;EACF,CAAC,EAAE,CAACjC,MAAM,EAAEY,aAAa,EAAEqB,YAAY,CAAC,CAAC;;EAEzC;EACA3D,SAAS,CAAC,MAAM;IACd,IAAIiB,SAAS,CAACM,OAAO,EAAE;MACrB,MAAMqD,gBAAgB,GAAGA,CAAA,KAAM;QAC7B3D,SAAS,CAACM,OAAO,CAACF,KAAK,GAAG,IAAI;QAC9BJ,SAAS,CAACM,OAAO,CAACD,MAAM,GAAG,GAAG;QAC9BqC,YAAY,CAAC,CAAC;MAChB,CAAC;MAEDiB,gBAAgB,CAAC,CAAC;MAClBC,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEF,gBAAgB,CAAC;MAEnD,OAAO,MAAM;QACXC,MAAM,CAACE,mBAAmB,CAAC,QAAQ,EAAEH,gBAAgB,CAAC;MACxD,CAAC;IACH;EACF,CAAC,EAAE,CAACjB,YAAY,CAAC,CAAC;EAElB3D,SAAS,CAAC,MAAM;IACd,MAAMgF,aAAa,GAAIC,CAAC,IAAK;MAC3B,IAAIA,CAAC,CAACC,IAAI,KAAK,OAAO,IAAI,CAACtC,cAAc,IAAIE,eAAe,CAACvB,OAAO,KAAK,IAAI,EAAE;QAC7E0D,CAAC,CAACE,cAAc,CAAC,CAAC;QAClBtC,iBAAiB,CAAC,IAAI,CAAC;QACvBuC,eAAe,CAACtC,eAAe,CAACvB,OAAO,CAAC;MAC1C,CAAC,MAAM,IAAI,CAAC0D,CAAC,CAACI,OAAO,IAAIJ,CAAC,CAACK,OAAO,KAAKL,CAAC,CAACM,GAAG,CAACC,WAAW,CAAC,CAAC,KAAK,GAAG,EAAE;QAClEP,CAAC,CAACE,cAAc,CAAC,CAAC;QAClB,IAAIF,CAAC,CAACQ,QAAQ,EAAE;UACd;UACAC,UAAU,CAAC,CAAC;QACd,CAAC,MAAM;UACL;UACAC,UAAU,CAAC,CAAC;QACd;MACF,CAAC,MAAM,IAAI,CAACV,CAAC,CAACI,OAAO,IAAIJ,CAAC,CAACK,OAAO,KAAKL,CAAC,CAACM,GAAG,KAAK,GAAG,EAAE;QACpD;QACAN,CAAC,CAACE,cAAc,CAAC,CAAC;QAClBO,UAAU,CAAC,CAAC;MACd,CAAC,MAAM,IAAIT,CAAC,CAACM,GAAG,KAAK,GAAG,EAAE;QACxB;QACAN,CAAC,CAACE,cAAc,CAAC,CAAC;QAClBpD,mBAAmB,CAAC,KAAK,CAAC;QAC1BE,qBAAqB,CAAC,KAAK,CAAC;QAC5BE,yBAAyB,CAAC,KAAK,CAAC;MAClC;IACF,CAAC;IAED,MAAMyD,WAAW,GAAIX,CAAC,IAAK;MACzB,IAAIA,CAAC,CAACC,IAAI,KAAK,OAAO,EAAE;QACtBD,CAAC,CAACE,cAAc,CAAC,CAAC;QAClBtC,iBAAiB,CAAC,KAAK,CAAC;QACxB;QACA,IAAIJ,YAAY,CAAClB,OAAO,EAAE;UACxB+B,YAAY,CAAC,CAAC,GAAG5B,MAAM,CAAC,CAAC;QAC3B;QACAmE,aAAa,CAAC,CAAC;MACjB;IACF,CAAC;IAEDhB,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEE,aAAa,CAAC;IACjDH,MAAM,CAACC,gBAAgB,CAAC,OAAO,EAAEc,WAAW,CAAC;IAE7C,OAAO,MAAM;MACXf,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAEC,aAAa,CAAC;MACpDH,MAAM,CAACE,mBAAmB,CAAC,OAAO,EAAEa,WAAW,CAAC;IAClD,CAAC;EACH,CAAC,EAAE,CAAChD,cAAc,EAAElB,MAAM,EAAE4B,YAAY,CAAC,CAAC,CAAC,CAAC;;EAE5C;EACAtD,SAAS,CAAC,MAAM;IACd,OAAO,MAAM;MACX,IAAImD,MAAM,CAAC5B,OAAO,EAAE;QAClBuE,oBAAoB,CAAC3C,MAAM,CAAC5B,OAAO,CAAC;QACpC4B,MAAM,CAAC5B,OAAO,GAAG,IAAI;MACvB;IACF,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMwE,iBAAiB,GAAG9F,WAAW,CAAEuE,QAAQ,IAAK;IAClDD,gBAAgB,CAACC,QAAQ,CAAC;EAC5B,CAAC,EAAE,CAACD,gBAAgB,CAAC,CAAC;EAEtB,MAAMoB,UAAU,GAAGA,CAAA,KAAM;IACvB,MAAMK,aAAa,GAAGzC,IAAI,CAAC,CAAC;IAC5B,IAAIyC,aAAa,EAAE;MACjBrE,SAAS,CAACqE,aAAa,CAAC;IAC1B;EACF,CAAC;EAED,MAAMN,UAAU,GAAGA,CAAA,KAAM;IACvB,MAAMO,SAAS,GAAGzC,IAAI,CAAC,CAAC;IACxB,IAAIyC,SAAS,EAAE;MACbtE,SAAS,CAACsE,SAAS,CAAC;IACtB;EACF,CAAC;;EAED;EACA,MAAMC,gBAAgB,GAAGhG,OAAO,CAAC,MAAM;IACrC,OAAO,CAAC4B,gBAAgB,IAAI,CAACE,kBAAkB,IACxC,CAACE,sBAAsB,IAAI,CAACE,qBAAqB;EAC1D,CAAC,EAAE,CAACN,gBAAgB,EAAEE,kBAAkB,EAAEE,sBAAsB,EAAEE,qBAAqB,CAAC,CAAC;;EAEzF;EACA,MAAM+D,YAAY,GAAGjG,OAAO,CAAC,MAAMC,YAAY,CAAC;IAC9CiG,QAAQ,EAAEF,gBAAgB;IAC1BG,aAAa,EAAEN,iBAAiB;IAChChD,SAAS;IACTE;EACF,CAAC,CAAC,EAAE,CAACiD,gBAAgB,EAAEH,iBAAiB,EAAEhD,SAAS,EAAEE,SAAS,CAAC,CAAC;EAEhE,MAAMqD,QAAQ,GAAGpG,OAAO,CAAC,MAAME,QAAQ,CAAC;IACtCgG,QAAQ,EAAEtE,gBAAgB;IAC1BuE,aAAa,EAAEN,iBAAiB;IAChCQ,eAAe,EAAE5B,kBAAkB;IAAE;IACrC1B;EACF,CAAC,CAAC,EAAE,CAACnB,gBAAgB,EAAEiE,iBAAiB,EAAEpB,kBAAkB,EAAE1B,SAAS,CAAC,CAAC;EAEzE,MAAMuD,UAAU,GAAGtG,OAAO,CAAC,MAAMK,UAAU,CAAC;IAC1C6F,QAAQ,EAAEpE,kBAAkB;IAC5BqE,aAAa,EAAEN,iBAAiB;IAChCQ,eAAe,EAAE5B,kBAAkB;IAAE;IACrC1B;EACF,CAAC,CAAC,EAAE,CAACjB,kBAAkB,EAAE+D,iBAAiB,EAAEpB,kBAAkB,EAAE1B,SAAS,CAAC,CAAC;EAE3E,MAAMwD,cAAc,GAAGvG,OAAO,CAAC,MAAMM,cAAc,CAAC;IAClD4F,QAAQ,EAAElE,sBAAsB;IAChCmE,aAAa,EAAEN,iBAAiB;IAChC9C;EACF,CAAC,CAAC,EAAE,CAACf,sBAAsB,EAAE6D,iBAAiB,EAAE9C,SAAS,CAAC,CAAC;EAE3D,MAAMyD,aAAa,GAAGxG,OAAO,CAAC,MAAMQ,aAAa,CAAC;IAChD0F,QAAQ,EAAEhE,qBAAqB;IAC/BiE,aAAa,EAAEN,iBAAiB;IAChCQ,eAAe,EAAE5B,kBAAkB;IAAE;IACrC1B;EACF,CAAC,CAAC,EAAE,CAACb,qBAAqB,EAAE2D,iBAAiB,EAAEpB,kBAAkB,EAAE1B,SAAS,CAAC,CAAC;EAE9E,MAAMmC,eAAe,GAAGnF,WAAW,CAAE0G,KAAK,IAAK;IAC7ClE,YAAY,CAAClB,OAAO,GAAG,IAAI;IAE3B,IAAIW,sBAAsB,EAAE;MAC1B;MACAuE,cAAc,CAACG,UAAU,CAACD,KAAK,EAAEjF,MAAM,CAAC;MACxC4B,YAAY,CAAC,CAAC,GAAG5B,MAAM,CAAC,CAAC;MACzBe,YAAY,CAAClB,OAAO,GAAG,KAAK;MAC5B;IACF;IAEA,IAAI2E,gBAAgB,EAAE;MACpB;MACA,MAAMW,KAAK,GAAGvG,cAAc,CAACqG,KAAK,CAAC;MACnChE,YAAY,CAACpB,OAAO,GAAGsF,KAAK;MAC5BV,YAAY,CAACW,WAAW,CAACH,KAAK,CAAC;IACjC,CAAC,MAAM;MACLjE,aAAa,CAACnB,OAAO,GAAGjB,cAAc,CAACqG,KAAK,CAAC;MAC7ChE,YAAY,CAACpB,OAAO,GAAGjB,cAAc,CAACqG,KAAK,CAAC;IAC9C;EACF,CAAC,EAAE,CAACjF,MAAM,EAAE+E,cAAc,EAAEvE,sBAAsB,EAAEgE,gBAAgB,EAAEC,YAAY,EAAE7C,YAAY,CAAC,CAAC;EAElG,MAAMyD,gBAAgB,GAAG9G,WAAW,CAAE0G,KAAK,IAAK;IAC9C,IAAI,CAAClE,YAAY,CAAClB,OAAO,EAAE;IAE3B,IAAI2E,gBAAgB,EAAE;MACpB;MACAvD,YAAY,CAACpB,OAAO,GAAG4E,YAAY,CAACa,UAAU,CAACrE,YAAY,CAACpB,OAAO,EAAEoF,KAAK,CAAC;IAC7E,CAAC,MAAM,IAAI7E,gBAAgB,EAAE;MAC3B;MACAwE,QAAQ,CAACW,aAAa,CAACvE,aAAa,CAACnB,OAAO,EAAEoF,KAAK,CAAC;MACpDhE,YAAY,CAACpB,OAAO,GAAGjB,cAAc,CAACqG,KAAK,CAAC;IAC9C,CAAC,MAAM,IAAI3E,kBAAkB,EAAE;MAC7B;MACAwE,UAAU,CAACS,aAAa,CAACvE,aAAa,CAACnB,OAAO,EAAEoF,KAAK,CAAC;MACtDhE,YAAY,CAACpB,OAAO,GAAGjB,cAAc,CAACqG,KAAK,CAAC;IAC9C,CAAC,MAAM,IAAIvE,qBAAqB,EAAE;MAChC;MACAsE,aAAa,CAACO,aAAa,CAACvE,aAAa,CAACnB,OAAO,EAAEoF,KAAK,CAAC;MACzDhE,YAAY,CAACpB,OAAO,GAAGjB,cAAc,CAACqG,KAAK,CAAC;IAC9C;EACF,CAAC,EAAE,CAACT,gBAAgB,EAAEC,YAAY,EAAErE,gBAAgB,EAAEwE,QAAQ,EAAEtE,kBAAkB,EAAEwE,UAAU,EAAEpE,qBAAqB,EAAEsE,aAAa,CAAC,CAAC;EAEtI,MAAMb,aAAa,GAAG5F,WAAW,CAAC,MAAM;IACtC,IAAIwC,YAAY,CAAClB,OAAO,EAAE;MACxB,IAAI,CAACO,gBAAgB,IAAIE,kBAAkB,IAAII,qBAAqB,KAChEM,aAAa,CAACnB,OAAO,IAAIoB,YAAY,CAACpB,OAAO,EAAE;QAEjD,MAAM2F,QAAQ,GAAGvE,YAAY,CAACpB,OAAO,CAAC0C,CAAC,GAAG,GAAG,GAAGtB,YAAY,CAACpB,OAAO,CAAC2C,CAAC;QACtE,IAAIiD,aAAa,GAAG,CAAC,GAAGzF,MAAM,CAAC;QAE/B,IAAII,gBAAgB,IAAIwE,QAAQ,CAACc,YAAY,EAAE;UAC7C,MAAMC,UAAU,GAAGf,QAAQ,CAACc,YAAY,CAAC1E,aAAa,CAACnB,OAAO,EAAE2F,QAAQ,CAAC;UACzE,IAAIG,UAAU,EAAE;YACdA,UAAU,CAACC,OAAO,CAACnD,GAAG,IAAI;cACxBgD,aAAa,CAAChD,GAAG,CAAC,GAAGlB,SAAS;YAChC,CAAC,CAAC;UACJ;QACF,CAAC,MAAM,IAAIjB,kBAAkB,IAAIwE,UAAU,CAACY,YAAY,EAAE;UACxD,MAAMG,YAAY,GAAGf,UAAU,CAACY,YAAY,CAAC1E,aAAa,CAACnB,OAAO,EAAE2F,QAAQ,CAAC;UAC7E,IAAIK,YAAY,EAAE;YAChBA,YAAY,CAACD,OAAO,CAACnD,GAAG,IAAI;cAC1BgD,aAAa,CAAChD,GAAG,CAAC,GAAGlB,SAAS;YAChC,CAAC,CAAC;UACJ;QACF,CAAC,MAAM,IAAIb,qBAAqB,IAAIsE,aAAa,CAACU,YAAY,EAAE;UAC9D,MAAMI,eAAe,GAAGd,aAAa,CAACU,YAAY,CAAC1E,aAAa,CAACnB,OAAO,EAAE2F,QAAQ,CAAC;UACnF,IAAIM,eAAe,EAAE;YACnBA,eAAe,CAACF,OAAO,CAACnD,GAAG,IAAI;cAC7BgD,aAAa,CAAChD,GAAG,CAAC,GAAGlB,SAAS;YAChC,CAAC,CAAC;UACJ;QACF;QAEAtB,SAAS,CAACwF,aAAa,CAAC;QACxB5E,gBAAgB,CAACX,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;QACzCyB,YAAY,CAAC6D,aAAa,CAAC;MAC7B,CAAC,MAAM,IAAI,CAACjF,sBAAsB,EAAE;QAClC;QACAoB,YAAY,CAAC,CAAC,GAAG5B,MAAM,CAAC,CAAC;MAC3B;IACF;IAEAe,YAAY,CAAClB,OAAO,GAAG,KAAK;IAC5BmB,aAAa,CAACnB,OAAO,GAAG,IAAI;IAC5BoB,YAAY,CAACpB,OAAO,GAAG,IAAI;EAC7B,CAAC,EAAE,CAACG,MAAM,EAAEI,gBAAgB,EAAEE,kBAAkB,EAAEI,qBAAqB,EAAEF,sBAAsB,EAAEoE,QAAQ,EAAEE,UAAU,EAAEE,aAAa,EAAEzD,SAAS,EAAEK,YAAY,CAAC,CAAC;EAE/J,MAAMmE,WAAW,GAAGxH,WAAW,CAAC,MAAM;IACpC,MAAMyH,QAAQ,GAAG9F,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IACxCF,SAAS,CAAC+F,QAAQ,CAAC;IACnBnF,gBAAgB,CAACX,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;IACzCa,aAAa,CAACnB,OAAO,GAAG,IAAI;IAC5BoB,YAAY,CAACpB,OAAO,GAAG,IAAI;IAC3BkB,YAAY,CAAClB,OAAO,GAAG,KAAK;IAC5B+B,YAAY,CAACoE,QAAQ,CAAC;EACxB,CAAC,EAAE,CAACpE,YAAY,CAAC,CAAC;EAElB,MAAMqE,gBAAgB,GAAG1H,WAAW,CAAE0G,KAAK,IAAK;IAC9C7D,eAAe,CAACvB,OAAO,GAAGoF,KAAK;IAC/B,IAAIlE,YAAY,CAAClB,OAAO,IAAIqB,cAAc,EAAE;MAC1CmE,gBAAgB,CAACJ,KAAK,CAAC;IACzB;EACF,CAAC,EAAE,CAAC/D,cAAc,EAAEmE,gBAAgB,CAAC,CAAC;;EAEtC;EACA,MAAMa,WAAW,GAAG1H,OAAO,CAAC,MAAM;IAChC,IAAIgG,gBAAgB,EAAE,OAAO,MAAM;IACnC,IAAIhE,sBAAsB,EAAE,OAAO,MAAM;IACzC,OAAO,WAAW;EACpB,CAAC,EAAE,CAACgE,gBAAgB,EAAEhE,sBAAsB,CAAC,CAAC;;EAE9C;EACAlC,SAAS,CAAC,MAAM;IACd,MAAM6H,eAAe,GAAI5C,CAAC,IAAK;MAC7B,IAAI,CAAC5B,UAAU,CAAC9B,OAAO,EAAE;;MAEzB;MACA,IAAI2E,gBAAgB,EAAE;QACpB,MAAM4B,IAAI,GAAG3G,QAAQ,CAAC4G,aAAa,CAAC,aAAa,CAAC,CAACC,qBAAqB,CAAC,CAAC;QAC1E,MAAMC,MAAM,GAAGhD,CAAC,CAACiD,OAAO,GAAGJ,IAAI,CAACK,IAAI;QACpC,MAAMC,MAAM,GAAGnD,CAAC,CAACoD,OAAO,GAAGP,IAAI,CAACQ,GAAG;;QAEnC;QACA,MAAMC,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACR,MAAM,GAAG,CAAC,CAAC;QACrC,MAAMS,MAAM,GAAGF,IAAI,CAACC,KAAK,CAACL,MAAM,GAAG,CAAC,CAAC;;QAErC;QACA,MAAMO,YAAY,GAAGD,MAAM,GAAG,GAAG,GAAGH,MAAM;QAC1CzF,eAAe,CAACvB,OAAO,GAAGoH,YAAY;QAEtC,IAAI5F,SAAS,KAAK,CAAC,EAAE;UACnB;UACA,IAAIwF,MAAM,IAAI,CAAC,IAAIA,MAAM,GAAG,GAAG,IAAIG,MAAM,IAAI,CAAC,IAAIA,MAAM,GAAG,EAAE,EAAE;YAC7DrF,UAAU,CAAC9B,OAAO,CAACqH,SAAS,GAAG,EAAE;YACjCvF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACV,IAAI,GAAG,GAAGI,MAAM,GAAG,CAAC,IAAI;YACjDlF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACP,GAAG,GAAG,GAAGI,MAAM,GAAG,CAAC,IAAI;YAChDrF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACxH,KAAK,GAAG,KAAK;YACtCgC,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACvH,MAAM,GAAG,KAAK;YACvC+B,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACC,OAAO,GAAG,OAAO;YAC1CzF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACE,MAAM,GAAG,aAAa9F,SAAS,GAAG,OAAO,GAAG,KAAK,EAAE;YAC5EI,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACG,YAAY,GAAG,GAAG,CAAC,CAAC;UAC/C;QACF,CAAC,MAAM;UACL;UACA;UACA3F,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACC,OAAO,GAAG,OAAO;UAC1CzF,UAAU,CAAC9B,OAAO,CAACqH,SAAS,GAAG,EAAE;UAEjC,MAAMK,IAAI,GAAGT,IAAI,CAACU,GAAG,CAAC,CAAC,EAAEX,MAAM,GAAGxF,SAAS,GAAG,CAAC,CAAC;UAChD,MAAMoG,IAAI,GAAGX,IAAI,CAACU,GAAG,CAAC,CAAC,EAAER,MAAM,GAAG3F,SAAS,GAAG,CAAC,CAAC;UAChD,MAAMqG,IAAI,GAAGZ,IAAI,CAACa,GAAG,CAAC,GAAG,EAAEd,MAAM,GAAGxF,SAAS,GAAG,CAAC,CAAC;UAClD,MAAMuG,IAAI,GAAGd,IAAI,CAACa,GAAG,CAAC,EAAE,EAAEX,MAAM,GAAG3F,SAAS,GAAG,CAAC,CAAC;UAEjDM,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACV,IAAI,GAAG,GAAGc,IAAI,GAAG,CAAC,IAAI;UAC/C5F,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACP,GAAG,GAAG,GAAGa,IAAI,GAAG,CAAC,IAAI;UAC9C9F,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACxH,KAAK,GAAG,GAAG,CAAC+H,IAAI,GAAGH,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI;UAC7D5F,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACvH,MAAM,GAAG,GAAG,CAACgI,IAAI,GAAGH,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI;UAC9D9F,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACE,MAAM,GAAG,aAAa9F,SAAS,GAAG,OAAO,GAAG,KAAK,EAAE;QAC9E;MACF,CAAC,MAAM;QACLI,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACC,OAAO,GAAG,MAAM;MAC3C;IACF,CAAC;IAED,MAAMS,IAAI,GAAGpI,QAAQ,CAAC4G,aAAa,CAAC,aAAa,CAAC;IAClD,IAAIwB,IAAI,EAAE;MACRA,IAAI,CAACzE,gBAAgB,CAAC,WAAW,EAAE+C,eAAe,EAAE;QAAE2B,OAAO,EAAE;MAAK,CAAC,CAAC;IACxE;IAEA,OAAO,MAAM;MACX,IAAID,IAAI,EAAE;QACRA,IAAI,CAACxE,mBAAmB,CAAC,WAAW,EAAE8C,eAAe,CAAC;MACxD;IACF,CAAC;EACH,CAAC,EAAE,CAAC9E,SAAS,EAAEmD,gBAAgB,EAAEjD,SAAS,CAAC,CAAC;;EAE5C;EACA;EACA,MAAMwG,WAAW,GAAGvJ,OAAO,CAAC,MAAM;IAChC,MAAMwJ,MAAM,GAAG,EAAE;IACjB;IACA,MAAMC,SAAS,GAAG,GAAG;IACrB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGlI,MAAM,CAACmI,MAAM,EAAED,CAAC,IAAID,SAAS,EAAE;MACjDD,MAAM,CAACI,IAAI,CAACpI,MAAM,CAACqI,KAAK,CAACH,CAAC,EAAEA,CAAC,GAAGD,SAAS,CAAC,CAAC;IAC7C;IACA,OAAOD,MAAM;EACf,CAAC,EAAE,CAAChI,MAAM,CAAC,CAAC;;EAEZ;EACA,MAAMsI,gBAAgB,GAAG/J,WAAW,CAAEgK,KAAK,IAAK;IAC9CA,KAAK,CAAC9E,cAAc,CAAC,CAAC;IAEtB,IAAI,CAACrC,eAAe,CAACvB,OAAO,IAAIuB,eAAe,CAACvB,OAAO,KAAK,CAAC,EAAE;IAE/D6D,eAAe,CAACtC,eAAe,CAACvB,OAAO,CAAC;EAC1C,CAAC,EAAE,CAAC6D,eAAe,CAAC,CAAC;;EAErB;EACApF,SAAS,CAAC,MAAM;IACdkK,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAEzI,MAAM,CAACmI,MAAM,EAAE,QAAQ,CAAC;IAC5D,MAAMN,IAAI,GAAGpI,QAAQ,CAAC4G,aAAa,CAAC,aAAa,CAAC;IAClDmC,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAE,CAAC,CAACZ,IAAI,CAAC;EAC7C,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMa,qBAAqB,GAAGnK,WAAW,CAAEgK,KAAK,IAAK;IACnD,IAAI,CAAChJ,SAAS,CAACM,OAAO,EAAE;IAExB,MAAMuG,IAAI,GAAG7G,SAAS,CAACM,OAAO,CAACyG,qBAAqB,CAAC,CAAC;IACtD,MAAMqC,MAAM,GAAG,GAAG,GAAGvC,IAAI,CAACzG,KAAK;IAC/B,MAAMiJ,MAAM,GAAG,EAAE,GAAGxC,IAAI,CAACxG,MAAM;IAC/B,MAAM4C,CAAC,GAAGsE,IAAI,CAACC,KAAK,CAAC,CAACwB,KAAK,CAAC/B,OAAO,GAAGJ,IAAI,CAACK,IAAI,IAAIkC,MAAM,CAAC;IAC1D,MAAMpG,CAAC,GAAGuE,IAAI,CAACC,KAAK,CAAC,CAACwB,KAAK,CAAC5B,OAAO,GAAGP,IAAI,CAACQ,GAAG,IAAIgC,MAAM,CAAC;IAEzD,IAAIpG,CAAC,IAAI,CAAC,IAAIA,CAAC,GAAG,GAAG,IAAID,CAAC,IAAI,CAAC,IAAIA,CAAC,GAAG,EAAE,EAAE;MACzC,MAAM0C,KAAK,GAAG1C,CAAC,GAAG,GAAG,GAAGC,CAAC;MACzBpB,eAAe,CAACvB,OAAO,GAAGoF,KAAK;MAC/BvB,eAAe,CAACuB,KAAK,CAAC;IACxB;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAM4D,qBAAqB,GAAGtK,WAAW,CAAEgK,KAAK,IAAK;IACnD,IAAI,CAAChJ,SAAS,CAACM,OAAO,EAAE;IAExB,MAAMuG,IAAI,GAAG7G,SAAS,CAACM,OAAO,CAACyG,qBAAqB,CAAC,CAAC;IACtD,MAAMqC,MAAM,GAAG,GAAG,GAAGvC,IAAI,CAACzG,KAAK;IAC/B,MAAMiJ,MAAM,GAAG,EAAE,GAAGxC,IAAI,CAACxG,MAAM;IAC/B,MAAM4C,CAAC,GAAGsE,IAAI,CAACC,KAAK,CAAC,CAACwB,KAAK,CAAC/B,OAAO,GAAGJ,IAAI,CAACK,IAAI,IAAIkC,MAAM,CAAC;IAC1D,MAAMpG,CAAC,GAAGuE,IAAI,CAACC,KAAK,CAAC,CAACwB,KAAK,CAAC5B,OAAO,GAAGP,IAAI,CAACQ,GAAG,IAAIgC,MAAM,CAAC;IAEzD,IAAIpG,CAAC,IAAI,CAAC,IAAIA,CAAC,GAAG,GAAG,IAAID,CAAC,IAAI,CAAC,IAAIA,CAAC,GAAG,EAAE,EAAE;MACzC,MAAM0C,KAAK,GAAG1C,CAAC,GAAG,GAAG,GAAGC,CAAC;MACzBpB,eAAe,CAACvB,OAAO,GAAGoF,KAAK;;MAE/B;MACA,IAAIlE,YAAY,CAAClB,OAAO,IAAIqB,cAAc,EAAE;QAC1CmE,gBAAgB,CAACJ,KAAK,CAAC;MACzB;;MAEA;MACA6D,kBAAkB,CAACtG,CAAC,EAAED,CAAC,CAAC;IAC1B;EACF,CAAC,EAAE,CAACrB,cAAc,CAAC,CAAC;;EAEpB;EACA,MAAM4H,kBAAkB,GAAGA,CAACjC,MAAM,EAAEG,MAAM,KAAK;IAC7C,IAAI,CAACrF,UAAU,CAAC9B,OAAO,IAAI,CAAC2E,gBAAgB,EAAE;IAE9C,MAAM4B,IAAI,GAAG7G,SAAS,CAACM,OAAO,CAACyG,qBAAqB,CAAC,CAAC;IACtD,MAAMyC,SAAS,GAAG3C,IAAI,CAACzG,KAAK,GAAG,GAAG,CAAC,CAAC;;IAEpC,IAAI0B,SAAS,KAAK,CAAC,EAAE;MACnB;MACAM,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACC,OAAO,GAAG,OAAO;MAC1CzF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACV,IAAI,GAAG,GAAGI,MAAM,GAAGkC,SAAS,IAAI;MACzDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACP,GAAG,GAAG,GAAGI,MAAM,GAAG+B,SAAS,IAAI;MACxDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACxH,KAAK,GAAG,GAAGoJ,SAAS,IAAI;MACjDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACvH,MAAM,GAAG,GAAGmJ,SAAS,IAAI;MAClDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACE,MAAM,GAAG,aAAa9F,SAAS,GAAG,OAAO,GAAG,KAAK,EAAE;IAC9E,CAAC,MAAM;MACL;MACA,MAAMgG,IAAI,GAAGT,IAAI,CAACU,GAAG,CAAC,CAAC,EAAEX,MAAM,GAAGxF,SAAS,GAAG,CAAC,CAAC;MAChD,MAAMoG,IAAI,GAAGX,IAAI,CAACU,GAAG,CAAC,CAAC,EAAER,MAAM,GAAG3F,SAAS,GAAG,CAAC,CAAC;MAChD,MAAMqG,IAAI,GAAGZ,IAAI,CAACa,GAAG,CAAC,GAAG,EAAEd,MAAM,GAAGxF,SAAS,GAAG,CAAC,CAAC;MAClD,MAAMuG,IAAI,GAAGd,IAAI,CAACa,GAAG,CAAC,EAAE,EAAEX,MAAM,GAAG3F,SAAS,GAAG,CAAC,CAAC;MAEjDM,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACC,OAAO,GAAG,OAAO;MAC1CzF,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACV,IAAI,GAAG,GAAGc,IAAI,GAAGwB,SAAS,IAAI;MACvDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACP,GAAG,GAAG,GAAGa,IAAI,GAAGsB,SAAS,IAAI;MACtDpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACxH,KAAK,GAAG,GAAG,CAAC+H,IAAI,GAAGH,IAAI,GAAG,CAAC,IAAIwB,SAAS,IAAI;MACrEpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACvH,MAAM,GAAG,GAAG,CAACgI,IAAI,GAAGH,IAAI,GAAG,CAAC,IAAIsB,SAAS,IAAI;MACtEpH,UAAU,CAAC9B,OAAO,CAACsH,KAAK,CAACE,MAAM,GAAG,aAAa9F,SAAS,GAAG,OAAO,GAAG,KAAK,EAAE;IAC9E;EACF,CAAC;EAED,oBACEnC,OAAA;IAAK4J,SAAS,EAAC,sBAAsB;IAAAC,QAAA,gBAEnC7J,OAAA;MAAK4J,SAAS,EAAC,iBAAiB;MAAC7B,KAAK,EAAE;QACtC+B,QAAQ,EAAE,OAAO;QACjBtC,GAAG,EAAE,MAAM;QACXH,IAAI,EAAE,MAAM;QACZ0C,MAAM,EAAE;MACV,CAAE;MAAAF,QAAA,eACA7J,OAAA,CAACH,eAAe;QAACmK,SAAS,EAAEpJ;MAAO;QAAAqJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACnC,CAAC,eAENpK,OAAA;MAAK4J,SAAS,EAAC,eAAe;MAAC7B,KAAK,EAAE;QACpC+B,QAAQ,EAAE,OAAO;QACjBtC,GAAG,EAAE,MAAM;QACX6C,KAAK,EAAE,MAAM;QACbN,MAAM,EAAE;MACV,CAAE;MAAAF,QAAA,eACA7J,OAAA,CAACF,UAAU;QAACkK,SAAS,EAAEpJ,MAAO;QAAC2E,aAAa,EAAE1E;MAAU;QAAAoJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACxD,CAAC,EAGLhF,gBAAgB,iBACfpF,OAAA;MAAK4J,SAAS,EAAC,oBAAoB;MAAAC,QAAA,gBACjC7J,OAAA;QAAOsK,OAAO,EAAC,WAAW;QAACvC,KAAK,EAAE;UAAEwC,KAAK,EAAE,OAAO;UAAEC,QAAQ,EAAE;QAAQ,CAAE;QAAAX,QAAA,GAAC,cAC3D,EAAC5H,SAAS;MAAA;QAAAgI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjB,CAAC,eACRpK,OAAA;QACEyK,IAAI,EAAC,OAAO;QACZC,EAAE,EAAC,WAAW;QACdd,SAAS,EAAC,mBAAmB;QAC7BrB,GAAG,EAAC,GAAG;QACPH,GAAG,EAAC,GAAG;QACPuC,KAAK,EAAE1I,SAAU;QACjB2I,QAAQ,EAAGzG,CAAC,IAAKjC,YAAY,CAAC2I,MAAM,CAAC1G,CAAC,CAAC2G,MAAM,CAACH,KAAK,CAAC;MAAE;QAAAV,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACvD,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CACN,eAGDpK,OAAA;MAAK4J,SAAS,EAAC,wBAAwB;MAAAC,QAAA,gBACrC7J,OAAA;QACE+K,OAAO,EAAEA,CAAA,KAAM;UACb9J,mBAAmB,CAAC,KAAK,CAAC;UAC1BE,qBAAqB,CAAC,KAAK,CAAC;UAC5BE,yBAAyB,CAAC,KAAK,CAAC;UAChCE,wBAAwB,CAAC,KAAK,CAAC;UAC/BE,gBAAgB,CAACX,KAAK,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC3C,CAAE;QACF6I,SAAS,EAAE,eAAexE,gBAAgB,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAAyE,QAAA,EAE5DxE,YAAY,CAAC2F;MAAQ;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAChB,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAEA,CAAA,KAAM;UACb9J,mBAAmB,CAAC,IAAI,CAAC;UACzBE,qBAAqB,CAAC,KAAK,CAAC;UAC5BE,yBAAyB,CAAC,KAAK,CAAC;UAChCE,wBAAwB,CAAC,KAAK,CAAC;QACjC,CAAE;QACFqI,SAAS,EAAE,eAAe5I,gBAAgB,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAA6I,QAAA,EAE5DrE,QAAQ,CAACwF;MAAQ;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACZ,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAEA,CAAA,KAAM;UACb9J,mBAAmB,CAAC,KAAK,CAAC;UAC1BE,qBAAqB,CAAC,IAAI,CAAC;UAC3BE,yBAAyB,CAAC,KAAK,CAAC;UAChCE,wBAAwB,CAAC,KAAK,CAAC;QACjC,CAAE;QACFqI,SAAS,EAAE,eAAe1I,kBAAkB,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAA2I,QAAA,EAE9DnE,UAAU,CAACsF;MAAQ;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACd,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAEA,CAAA,KAAM;UACb9J,mBAAmB,CAAC,KAAK,CAAC;UAC1BE,qBAAqB,CAAC,KAAK,CAAC;UAC5BE,yBAAyB,CAAC,KAAK,CAAC;UAChCE,wBAAwB,CAAC,IAAI,CAAC;QAChC,CAAE;QACFqI,SAAS,EAAE,eAAetI,qBAAqB,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAAuI,QAAA,EAEjEjE,aAAa,CAACoF;MAAQ;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjB,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAEA,CAAA,KAAM;UACb9J,mBAAmB,CAAC,KAAK,CAAC;UAC1BE,qBAAqB,CAAC,KAAK,CAAC;UAC5BE,yBAAyB,CAAC,IAAI,CAAC;UAC/BE,wBAAwB,CAAC,KAAK,CAAC;QACjC,CAAE;QACFqI,SAAS,EAAE,eAAexI,sBAAsB,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAAyI,QAAA,EAElElE,cAAc,CAACqF;MAAQ;QAAAf,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAClB,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAElG,UAAW;QACpB+E,SAAS,EAAC,aAAa;QACvBqB,QAAQ,EAAE,CAACtI,OAAQ;QACnBoF,KAAK,EAAE;UAAEmD,UAAU,EAAE;QAAO,CAAE;QAAArB,QAAA,EAC/B;MAED;QAAAI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACTpK,OAAA;QACE+K,OAAO,EAAEnG,UAAW;QACpBgF,SAAS,EAAC,aAAa;QACvBqB,QAAQ,EAAE,CAACrI,OAAQ;QAAAiH,QAAA,EACpB;MAED;QAAAI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC,eAGNpK,OAAA;MAAK+H,KAAK,EAAE;QAAE+B,QAAQ,EAAE,UAAU;QAAEvJ,KAAK,EAAE,QAAQ;QAAEC,MAAM,EAAE;MAAQ,CAAE;MAAAqJ,QAAA,gBAErE7J,OAAA;QAAK+H,KAAK,EAAE;UACV+B,QAAQ,EAAE,UAAU;UACpBzC,IAAI,EAAE,OAAO;UACbG,GAAG,EAAE,CAAC;UACNQ,OAAO,EAAE,MAAM;UACfmD,aAAa,EAAE,QAAQ;UACvBC,UAAU,EAAE,QAAQ;UACpB5K,MAAM,EAAE,MAAM;UACd6K,cAAc,EAAE,QAAQ;UACxBtB,MAAM,EAAE;QACV,CAAE;QAAAF,QAAA,gBACA7J,OAAA;UACE+K,OAAO,EAAEA,CAAA,KAAM3I,YAAY,CAAC,IAAI,CAAE;UAClC2F,KAAK,EAAE;YACLxH,KAAK,EAAE,MAAM;YACbC,MAAM,EAAE,MAAM;YACd8K,eAAe,EAAE,MAAM;YACvBrD,MAAM,EAAE9F,SAAS,GAAG,mBAAmB,GAAG,gBAAgB;YAC1DoJ,YAAY,EAAE,MAAM;YACpBC,MAAM,EAAE,SAAS;YACjBC,SAAS,EAAE;UACb,CAAE;UACFC,KAAK,EAAC;QAAc;UAAAzB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrB,CAAC,eACFpK,OAAA;UACE+K,OAAO,EAAEA,CAAA,KAAM3I,YAAY,CAAC,KAAK,CAAE;UACnC2F,KAAK,EAAE;YACLxH,KAAK,EAAE,MAAM;YACbC,MAAM,EAAE,MAAM;YACd8K,eAAe,EAAE,MAAM;YACvBrD,MAAM,EAAE,CAAC9F,SAAS,GAAG,eAAe,GAAG,gBAAgB;YACvDqJ,MAAM,EAAE,SAAS;YACjBC,SAAS,EAAE;UACb,CAAE;UACFC,KAAK,EAAC;QAAgB;UAAAzB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACvB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC,eAGNpK,OAAA;QAAK4J,SAAS,EAAC,kBAAkB;QAAC7B,KAAK,EAAE;UAAE+B,QAAQ,EAAE;QAAW,CAAE;QAAAD,QAAA,gBAChE7J,OAAA;UACE2L,GAAG,EAAExL,SAAU;UACfI,KAAK,EAAC,MAAM;UACZC,MAAM,EAAC,KAAK;UACZuH,KAAK,EAAE;YACLC,OAAO,EAAE,OAAO;YAChBsD,eAAe,EAAE,MAAM;YACvBrD,MAAM,EAAE,gBAAgB;YACxB2D,cAAc,EAAE;UAClB,CAAE;UACFC,WAAW,EAAEvC,qBAAsB;UACnCwC,WAAW,EAAErC,qBAAsB;UACnCsC,SAAS,EAAEhH,aAAc;UACzBiH,YAAY,EAAEjH;QAAc;UAAAkF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7B,CAAC,eACFpK,OAAA;UACE4J,SAAS,EAAC,eAAe;UACzB+B,GAAG,EAAEpJ,UAAW;UAChBwF,KAAK,EAAE;YACL+B,QAAQ,EAAE,UAAU;YACpBmC,aAAa,EAAE,MAAM;YACrBlC,MAAM,EAAE,GAAG;YACX/B,OAAO,EAAE,MAAM;YACfkE,WAAW,EAAE/J,SAAS,GAAG,OAAO,GAAG;UACrC;QAAE;UAAA8H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACJ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eACNpK,OAAA,CAACT,WAAW;MAAC4M,OAAO,EAAExF;IAAY;MAAAsD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAClC,CAAC;AAEV,CAAC;AAACzJ,GAAA,CAzqBID,SAAS;EAAA,QAQcT,kBAAkB,EAYUN,WAAW;AAAA;AAAAyM,EAAA,GApB9D1L,SAAS;AA2qBf,eAAeA,SAAS;AAAC,IAAA0L,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module"}