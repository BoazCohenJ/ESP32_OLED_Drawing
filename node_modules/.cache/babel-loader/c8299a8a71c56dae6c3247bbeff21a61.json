{"ast":null,"code":"import React from 'react';\nconst getCoordinates = index => ({\n  x: index % 128,\n  y: Math.floor(index / 128)\n});\nconst getIndex = (x, y) => y * 128 + x;\nconst drawCircle = (center, point) => {\n  const points = [];\n  // Calculate radius as the distance between center and point\n  const radius = Math.floor(Math.sqrt(Math.pow(point.x - center.x, 2) + Math.pow(point.y - center.y, 2)));\n\n  // Use the initial click point as the center\n  const actualCenter = center;\n  let x = radius;\n  let y = 0;\n  let error = 0;\n  while (x >= y) {\n    // Add points in all octants using the center point\n    const coordinates = [[actualCenter.x + x, actualCenter.y + y], [actualCenter.x + y, actualCenter.y + x], [actualCenter.x - y, actualCenter.y + x], [actualCenter.x - x, actualCenter.y + y], [actualCenter.x - x, actualCenter.y - y], [actualCenter.x - y, actualCenter.y - x], [actualCenter.x + y, actualCenter.y - x], [actualCenter.x + x, actualCenter.y - y]];\n    coordinates.forEach(([px, py]) => {\n      if (px >= 0 && px < 128 && py >= 0 && py < 64) {\n        const index = getIndex(px, py);\n        if (index >= 0 && index < 8192) {\n          points.push(index);\n        }\n      }\n    });\n    y++;\n    error += 1 + 2 * y;\n    if (2 * (error - x) + 1 > 0) {\n      x--;\n      error += 1 - 2 * x;\n    }\n  }\n  return points;\n};\nconst CircleMode = ({\n  isActive,\n  onPixelUpdate,\n  onPreviewUpdate,\n  drawColor = true\n}) => {\n  // The key fix is here - we modify how we call onPreviewUpdate\n  const updateCircle = (centerPoint, currentPoint) => {\n    if (!centerPoint || !currentPoint) return;\n    const circlePoints = drawCircle(centerPoint, currentPoint);\n\n    // Instead of returning a single array, we'll use the callback pattern\n    // but in a different way - we'll check drawColor and update pixels directly\n    if (drawColor) {\n      // For white - use the normal approach\n      const newPreview = Array(8192).fill(false);\n      circlePoints.forEach(idx => {\n        newPreview[idx] = true;\n      });\n      return newPreview;\n    } else {\n      // For black - we need to handle this differently since the rendering code\n      // doesn't support black previews currently\n      // Let's directly update the style of the elements in the DOM\n      onPreviewUpdate(prevPreview => {\n        // First clear any previous previews\n        const newPreview = Array(8192).fill(false);\n\n        // Add a short delay to find elements and update them directly \n        setTimeout(() => {\n          const pixels = document.querySelectorAll('.pixel-grid .pixel');\n          circlePoints.forEach(idx => {\n            if (pixels[idx]) {\n              pixels[idx].style.border = '1px solid red';\n            }\n          });\n        }, 0);\n        return newPreview;\n      });\n      // Return empty preview for black since we're handling it with direct DOM updates\n      return Array(8192).fill(false);\n    }\n  };\n  const handlePreview = (centerPoint, currentIndex) => {\n    if (!centerPoint || typeof currentIndex !== 'number') return;\n    const currentPoint = getCoordinates(currentIndex);\n    const previewState = updateCircle(centerPoint, currentPoint);\n    if (drawColor) {\n      // Only update through the normal state flow for white\n      onPreviewUpdate(() => previewState);\n    }\n    // For black, we already updated the DOM directly\n  };\n  const handleCommit = (centerPoint, endIndex) => {\n    if (!centerPoint || typeof endIndex !== 'number') return;\n\n    // When committing, clear any custom styles we might have added\n    const pixels = document.querySelectorAll('.pixel-grid .pixel');\n    pixels.forEach(p => p.style.border = '');\n    const endPoint = getCoordinates(endIndex);\n    const circlePoints = drawCircle(centerPoint, endPoint);\n    return circlePoints;\n  };\n  return {\n    handlePreview,\n    handleCommit,\n    modeName: 'Circle Mode',\n    isActive\n  };\n};\n_c = CircleMode;\nexport default CircleMode;\nvar _c;\n$RefreshReg$(_c, \"CircleMode\");","map":{"version":3,"names":["React","getCoordinates","index","x","y","Math","floor","getIndex","drawCircle","center","point","points","radius","sqrt","pow","actualCenter","error","coordinates","forEach","px","py","push","CircleMode","isActive","onPixelUpdate","onPreviewUpdate","drawColor","updateCircle","centerPoint","currentPoint","circlePoints","newPreview","Array","fill","idx","prevPreview","setTimeout","pixels","document","querySelectorAll","style","border","handlePreview","currentIndex","previewState","handleCommit","endIndex","p","endPoint","modeName","_c","$RefreshReg$"],"sources":["C:/Users/wikx3/Documents/VS_code/React/AOD/src/components/pixelGrid/CircleMode.jsx"],"sourcesContent":["import React from 'react';\r\n\r\nconst getCoordinates = (index) => ({\r\n  x: index % 128,\r\n  y: Math.floor(index / 128)\r\n});\r\n\r\nconst getIndex = (x, y) => y * 128 + x;\r\n\r\nconst drawCircle = (center, point) => {\r\n  const points = [];\r\n  // Calculate radius as the distance between center and point\r\n  const radius = Math.floor(Math.sqrt(\r\n    Math.pow(point.x - center.x, 2) + \r\n    Math.pow(point.y - center.y, 2)\r\n  ));\r\n\r\n  // Use the initial click point as the center\r\n  const actualCenter = center;\r\n\r\n  let x = radius;\r\n  let y = 0;\r\n  let error = 0;\r\n\r\n  while (x >= y) {\r\n    // Add points in all octants using the center point\r\n    const coordinates = [\r\n      [actualCenter.x + x, actualCenter.y + y],\r\n      [actualCenter.x + y, actualCenter.y + x],\r\n      [actualCenter.x - y, actualCenter.y + x],\r\n      [actualCenter.x - x, actualCenter.y + y],\r\n      [actualCenter.x - x, actualCenter.y - y],\r\n      [actualCenter.x - y, actualCenter.y - x],\r\n      [actualCenter.x + y, actualCenter.y - x],\r\n      [actualCenter.x + x, actualCenter.y - y],\r\n    ];\r\n\r\n    coordinates.forEach(([px, py]) => {\r\n      if (px >= 0 && px < 128 && py >= 0 && py < 64) {\r\n        const index = getIndex(px, py);\r\n        if (index >= 0 && index < 8192) {\r\n          points.push(index);\r\n        }\r\n      }\r\n    });\r\n\r\n    y++;\r\n    error += 1 + 2 * y;\r\n    if (2 * (error - x) + 1 > 0) {\r\n      x--;\r\n      error += 1 - 2 * x;\r\n    }\r\n  }\r\n\r\n  return points;\r\n};\r\n\r\nconst CircleMode = ({ isActive, onPixelUpdate, onPreviewUpdate, drawColor = true }) => {\r\n  // The key fix is here - we modify how we call onPreviewUpdate\r\n  const updateCircle = (centerPoint, currentPoint) => {\r\n    if (!centerPoint || !currentPoint) return;\r\n    \r\n    const circlePoints = drawCircle(centerPoint, currentPoint);\r\n    \r\n    // Instead of returning a single array, we'll use the callback pattern\r\n    // but in a different way - we'll check drawColor and update pixels directly\r\n    if (drawColor) {\r\n      // For white - use the normal approach\r\n      const newPreview = Array(8192).fill(false);\r\n      circlePoints.forEach(idx => {\r\n        newPreview[idx] = true;\r\n      });\r\n      return newPreview;\r\n    } else {\r\n      // For black - we need to handle this differently since the rendering code\r\n      // doesn't support black previews currently\r\n      // Let's directly update the style of the elements in the DOM\r\n      onPreviewUpdate(prevPreview => {\r\n        // First clear any previous previews\r\n        const newPreview = Array(8192).fill(false);\r\n\r\n        // Add a short delay to find elements and update them directly \r\n        setTimeout(() => {\r\n          const pixels = document.querySelectorAll('.pixel-grid .pixel');\r\n          circlePoints.forEach(idx => {\r\n            if (pixels[idx]) {\r\n              pixels[idx].style.border = '1px solid red';\r\n            }\r\n          });\r\n        }, 0);\r\n        \r\n        return newPreview;\r\n      });\r\n      // Return empty preview for black since we're handling it with direct DOM updates\r\n      return Array(8192).fill(false);\r\n    }\r\n  };\r\n\r\n  const handlePreview = (centerPoint, currentIndex) => {\r\n    if (!centerPoint || typeof currentIndex !== 'number') return;\r\n    \r\n    const currentPoint = getCoordinates(currentIndex);\r\n    const previewState = updateCircle(centerPoint, currentPoint);\r\n    \r\n    if (drawColor) {\r\n      // Only update through the normal state flow for white\r\n      onPreviewUpdate(() => previewState);\r\n    }\r\n    // For black, we already updated the DOM directly\r\n  };\r\n\r\n  const handleCommit = (centerPoint, endIndex) => {\r\n    if (!centerPoint || typeof endIndex !== 'number') return;\r\n    \r\n    // When committing, clear any custom styles we might have added\r\n    const pixels = document.querySelectorAll('.pixel-grid .pixel');\r\n    pixels.forEach(p => p.style.border = '');\r\n    \r\n    const endPoint = getCoordinates(endIndex);\r\n    const circlePoints = drawCircle(centerPoint, endPoint);\r\n    \r\n    return circlePoints;\r\n  };\r\n\r\n  return {\r\n    handlePreview,\r\n    handleCommit,\r\n    modeName: 'Circle Mode',\r\n    isActive\r\n  };\r\n};\r\n\r\nexport default CircleMode;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}